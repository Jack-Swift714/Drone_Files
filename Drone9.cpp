#include <gnc_functions.hpp>
#include <math.h>
//include API 


double xList [499] = {
195.498223585557,197.093310113124,198.609277375969,200.032468302603,201.347089799128,202.537466562499,204.071557307401,205.512238495854,206.843547869036,208.048149710979,209.107018416372,210.527592211106,211.834475360160,213.462921032951,215.009787537823,216.460559018516,217.799310484381,219.008536967519,220.552509628172,221.996041849854,223.318231421186,224.494354582862,225.495773514921,226.296958404043,227.457934823958,228.434723953887,229.198216173189,229.719023805701,230.599091830813,231.250849476956,232.264780539773,233.069585274976,234.228772951129,235.196947872978,235.946123075755,237.046544299250,237.939503806751,238.593737896373,239.592956107718,240.358728558374,240.857238030556,241.692589052369,242.268036040248,243.177093024093,243.831509909969,244.195313167321,244.898615600684,245.321469598303,246.087479852014,246.582026539701,247.199575323098,247.941211035329,248.814029538695,249.822991658214,250.391065069654,251.084388260290,251.908409688721,252.267862128196,252.744859190454,253.348242243487,254.097282176675,254.999646506551,256.060996012536,257.283010588534,258.130196593609,259.138677564964,260.312519538118,261.652381460779,263.154200927297,264.357964089949,265.731073833148,267.267534150344,268.517069905384,269.938622002536,271.525260799455,273.262256224498,275.125232679129,276.830611042108,278.667440015031,280.334529339189,282.095669578809,283.942388258436,285.861293659295,287.833181937831,289.831587331630,291.821912047908,293.761046583937,295.597682987353,297.537079024865,299.373418637712,301.047522260694,302.863988112215,304.508316350879,306.299623587508,307.906875685158,309.666078134942,311.226993601001,312.945275927713,314.448481689447,316.114661921793,317.546021355804,319.145993757732,320.488330240917,322.004496573626,323.237692047123,324.649502683136,325.750877198220,327.034169293424,328.494425749022,329.656151273951,330.998727195743,332.014002931340,333.212009532222,334.590247875386,335.649475868028,336.891357866534,338.311806033053,339.422863313425,340.715370164703,341.668504480481,342.804446156328,344.122617639147,345.108274571022,346.278177673031,347.630492903436,348.659205803896,349.872393223361,351.266844349979,352.347940789172,353.613205444650,355.057848976642,356.201660819727,357.529322484643,359.033748232591,360.254084324871,361.655558011123,362.746659650318,364.022926848900,365.479958598221,367.105782964620,368.485429251344,370.040514968963,371.329612896630,372.800553856212,374.441451797345,375.845219845398,377.425833869450,379.165474442064,380.704920494056,382.409771259704,384.254019912976,385.944025512594,387.777375375205,389.716736973092,391.557073066652,393.501467163353,395.497951599626,397.457672092647,399.457245438360,401.432066451606,403.431421036891,405.382891095529,407.372943422512,409.283366109477,411.249069857021,413.097680668971,415.018211295113,416.778343308371,418.625861971669,420.263721726557,422.001789195079,423.829445490826,425.434673450643,427.142264990998,428.571792593418,430.112326530214,431.758882251863,433.102584789532,434.559089473179,436.125711013119,437.362107134494,438.712796909890,440.176295875829,441.278662749210,442.494671937455,443.824728796828,445.267886756820,446.343304589820,447.532347842935,448.836016135552,449.739009609850,450.752439049723,451.878970528123,453.120323162690,454.476546252469,455.443352963342,456.522909756655,457.717450577532,459.027821806311,459.939381121558,460.963232202420,462.101512920393,463.355802739298,464.200052628599,465.155021346793,466.223594701930,467.408064006073,468.709371275237,469.611436179787,470.626553812313,471.757223384690,473.005200264696,474.370725422265,475.353146434298,476.451087717567,477.666616330999,479.000548904349,480.451862732741,481.543442760246,482.752874573691,484.081309331305,485.528260349901,487.090831830741,488.763278382183,490.148538735085,491.651881880821,493.269553958138,494.994472392483,496.815570842748,498.417793893467,500.129024970215,501.939083065908,503.832931536121,505.553469802998,507.372445171140,509.274538451669,511.238155270098,513.234663830032,515.173458471827,517.159284374649,519.158907677148,521.130896901250,523.130871382534,525.110529628976,527.020642376958,529.001335813990,530.913009653256,532.697773661171,534.596883555087,536.360350778320,538.242826511056,539.978981202324,541.501882864794,543.181218517807,544.626088748513,546.234644473918,547.585210387652,549.106115133724,550.783783613677,552.225178957238,553.829994819319,555.173588196531,556.686768173378,557.911213358810,559.310374252041,560.391526339824,561.650861716385,563.084474305109,564.208391062054,565.510546904482,566.984933938820,568.159614923009,569.510834965981,570.531936673766,571.731937830530,573.108176540479,574.160021207345,575.390810179736,576.796827054329,577.885512272700,579.152687909421,580.071821332078,581.170173813862,582.448006939777,583.381286220764,584.495385791836,585.790171296596,586.745681652983,587.883529092921,589.203019850117,590.190374615874,591.361838532342,592.715825405818,593.747395053202,594.964906702666,596.365387681930,597.456827707339,598.735692320680,600.200173266167,601.836224518323,603.232640558535,604.807204795239,606.125015734257,607.627632287265,609.299793808833,610.747305465741,612.371005598779,614.148808378160,615.741686092713,617.494422529592,619.375907212825,621.120685419241,622.996860544664,624.961972619520,626.846742179851,628.817016119449,630.712430691295,632.688646690433,634.687965659057,636.675239172340,638.670210407306,640.666065513786,642.650910579418,644.548898733322,646.508432410511,648.347479676650,650.263831653964,652.021208766065,653.870977172279,655.518694624097,657.272223293030,659.118398999886,660.758904814377,662.505393532470,663.997504348282,665.606225412689,666.909314271702,668.335479941758,669.881628910538,671.101810648123,672.446595004529,673.914271789525,675.033422798633,676.277854058105,677.647466915960,679.139393860784,680.287909161079,681.561719016259,682.959885225211,683.986401317201,685.133311340763,686.402079850944,687.792041713663,688.807799960566,689.943868968023,691.201667368392,692.056335966167,693.028015704435,694.120392515651,695.335620067817,696.673406411146,697.625328345474,698.697509117121,699.892363053584,701.210195307405,702.138420667143,703.186753751956,704.357977472040,705.652882433071,706.554454192301,707.576135744113,708.721458187111,709.992278892447,711.387853285632,712.415572326014,713.567844735903,714.846754547525,716.251893039367,717.780196325770,718.978994478800,720.305302927579,721.758202336602,723.333807422144,724.597351546213,725.989465011482,727.508412657706,729.148891303065,730.901364508540,732.410539240054,734.043002950455,735.789967194565,737.637255263660,739.564631048610,741.349410440401,743.228863316636,745.180212994816,747.173118019104,749.101381138042,751.083552245854,753.083436306669,755.056104992235,757.055646366907,759.038009027602,760.950580494436,762.930869646026,764.837700391556,766.814601104519,768.712866690476,770.469037240151,772.342073036064,774.057549029389,775.897599380955,777.561756846916,779.358544726834,780.957916725316,782.698305308604,784.216691977202,785.884350590441,787.302176632656,788.877079470426,790.171756372268,791.630292487203,792.776560804944,794.091731093701,795.570600756961,796.742123771688,798.082490769455,799.585003028648,800.785871178433,802.154379367926,803.187660684466,804.391655026497,805.763722655190,806.801671394558,808.010868159783,809.388339864536,810.433174451322,811.649475299221,813.034028104915,814.087823925144,815.313155181805,816.706630045382,817.771922678729,819.008868040709,820.413670592114,821.493262613403,822.744470589595,824.163230205467,825.260601295860,826.529629586791,827.965910203847,829.085901508406,830.377729880139,831.836512282851,832.985868335811,834.307376724100,835.795443953947,836.983402437176,838.343889851157,839.870209556455,841.109059738749,842.520601322939,844.096405961382,845.820848581581,847.324137618748,848.984748241173,850.782587184372,852.390174156167,854.143607425866,856.017155461635,857.738317273094,859.587200896585,861.530504392418,863.367067639277,865.302641345020,867.294134487514,869.231823425212,871.224328016485,873.165733070778,875.159854410527,877.149856053544,879.148075749497,881.129070779661,883.022066314902,884.981325356570,886.825622786180,888.750056988971,890.528027053743,892.399971410949,894.089290017508,895.885743487376,897.459039919433,899.151143673524,900.949842545201,902.524886608234,904.217711112769,905.640773221739,907.190349330576,908.421607236588
};
double yList [499] = {
193.569514899538,194.776038405141,196.080585551848,197.485764396817,198.993003701265,200.600176113058,201.883361830874,203.270602874541,204.763122674370,206.359660930218,208.056362749849,209.464187346067,210.978141253793,212.139246197700,213.407001700984,214.783686890418,216.269534969006,217.862573359152,219.133851622615,220.518125701318,222.018730491881,223.636362807511,225.367593618960,227.200106312898,228.828643617476,230.573889444187,232.422423899117,234.353423487392,236.149385700574,238.040208794016,239.764141449271,241.595067263769,243.224878274731,244.974917508778,246.829300564013,248.499352398802,250.288939870250,252.178907530285,253.911409468557,255.759000482233,257.695876396210,259.513068920506,261.428495965355,263.209960363013,265.099864736118,267.066498202206,268.938760386631,270.893547970154,272.741040403484,274.678931931330,276.581202548284,278.438613776402,280.238110333827,281.964955851346,283.882582665722,285.758563196892,287.580921198352,289.548354537440,291.490640253445,293.397451437415,295.251889136150,297.036752888980,298.731903981404,300.315153922522,302.126859161462,303.853985714560,305.473274145341,306.958120948282,308.278930658266,309.876101359300,311.330257345819,312.610604835247,314.172225915047,315.579062662891,316.796673983515,317.788060332715,318.515603272678,319.560440407874,320.351679514737,321.456583666814,322.404415432683,323.172289197256,323.736028554189,324.070179144448,324.150028264885,323.953540291274,323.463890159874,322.672204160473,322.183590806498,321.391216635863,320.296969378834,319.460039387580,318.321538336403,317.432033764182,316.241764595213,315.290341061409,314.039923967869,313.016446637535,311.697214877043,310.590940302925,309.194083055148,307.994046258600,306.511436139280,305.207120360198,303.632563621257,302.215951208477,300.546527901607,299.012526142029,297.645905827574,296.017902816296,294.535509516856,292.812368437110,291.210875326215,289.761579266249,288.065101721569,286.497387110492,285.089435759687,283.426440955205,281.900195221583,280.141919083974,278.495821726867,276.991686114004,275.251433140254,273.629296668835,272.155782665638,270.440629678752,268.850605689859,267.416902074926,265.734276005603,264.185371440564,262.802257177218,261.161618744284,259.665853220041,258.348012877318,256.763468835052,255.336629143025,253.660473657115,252.120622353312,250.750564514581,249.585791948960,248.137836105873,246.880176211125,245.351050142782,243.995936607530,242.852497082769,241.427914594015,240.202492500625,239.215755109970,237.938999121926,236.893301332471,236.119513955408,235.049990195381,234.250722855086,233.761972824250,232.978925531464,232.510597017794,232.392064761764,231.992695772941,231.951386753207,231.635029414676,231.685835342496,232.123744705537,232.322972554668,232.914821485670,233.283615163616,234.046922484387,234.605099977708,235.554802718518,236.320749706740,237.468536892293,238.458042564266,239.270244795619,240.463242363522,241.504458542472,242.903190408814,244.178633543406,245.313910714632,246.795282879303,248.165901026897,249.409161639398,250.981206368739,252.456210480815,253.819357859749,255.488126051102,257.075993065088,258.569629148889,259.954293405131,261.640554501304,263.248713741622,264.765436848462,266.549982388754,268.274209975356,269.926761586706,271.494895393705,272.964813395074,274.715608866799,276.399223172396,278.003303041748,279.514238924830,281.294424200240,283.012483851189,284.656964622464,286.214769825366,288.027845147689,289.785125645296,291.475732336603,293.087263430794,294.606012715969,296.391027816179,298.114262040577,299.763985144041,301.326852287137,302.788132904967,304.530214692690,306.201897957694,307.790132886767,309.280308678328,310.656422108071,312.332266087548,313.925148596909,315.420227556284,316.800927650361,318.049274704374,319.146052955695,320.588638743327,321.907713944432,323.083782416192,324.096035544049,324.922836871117,326.119867069460,327.155090814344,328.005790344271,328.648704002448,329.668384379926,330.499846110910,331.117940886948,331.497689475338,331.615814705959,332.106808939068,332.344496725213,332.305681159987,331.972126816550,331.982229994955,331.697707188674,331.104858734180,330.827634080696,330.239838935885,329.337277339067,328.710075927373,327.766580642497,327.091091844912,326.098233905433,324.801788562796,323.715587953093,322.332710512240,321.144203685055,319.669086160021,318.370298743477,317.281524904991,315.895025909837,314.701474047197,313.220002874101,311.912223704031,310.330852783636,308.901745091804,307.219154778305,305.665425583965,304.270880874946,302.616549855030,301.098528062686,299.747164724063,298.128484834342,296.653966473836,294.934271354822,293.334272222396,291.883077193037,290.182011998288,288.605573447173,287.183210431499,285.505484442161,283.958142881386,282.181856375398,280.510443252990,278.971891173171,277.202996098928,275.542037897848,274.017724774941,272.260738730934,270.615958136621,269.112979713065,267.373689465137,265.752679812972,264.280701706323,262.567265374679,260.980550093534,259.552736020652,257.876800857547,256.339106056637,254.977013710170,253.826650158800,252.394860285027,251.161674384810,249.657222880439,248.337320045142,247.240107282826,245.859994967427,244.692263029879,243.776065847158,242.566627718736,241.603344280262,240.925099938774,239.947475772536,239.254679338693,238.882745832198,238.213684023058,237.870142754878,237.231860998258,236.924338113339,236.976526825728,236.751262573336,236.893000964944,236.764306000242,237.010049902375,237.640637697721,238.040922306420,238.826991739044,239.399350978548,240.354141890666,241.114639650936,242.248230052700,243.210070583782,243.979248885227,245.123250927455,246.097816039478,247.429583779490,248.617866800043,250.135087754787,251.537247332566,252.805877840767,254.390540747276,255.870930910296,257.229579082114,258.887137834862,260.452829643760,261.910279683932,263.242253404133,264.879602665894,266.421487373921,267.851568229028,269.568036904211,271.206511010767,272.752546737254,274.190603071403,275.913459764181,277.559469244802,279.114442937193,280.922630313539,282.670725987763,284.346050703249,285.934515999205,287.421233087155,289.180165897397,290.868487073272,292.472333721341,293.976766554932,295.748318891596,297.451550450512,299.072733659625,300.596945305657,302.382209533428,304.101560226767,305.741144473326,307.285493765064,308.718104009717,310.433852701699,312.068560104694,313.606217314132,315.029448082049,316.319521360887,317.920422041220,319.417387604851,320.791826874976,322.023682635369,323.573991071304,325.009964643421,326.311040370667,327.455081372608,328.418843617195,329.731242805613,330.886691737511,331.860404184694,332.626907146059,333.160969486601,334.063500662040,334.747355095390,335.185800569156,335.354114454999,335.884964098634,336.151418033400,336.129883333551,336.459395483538,336.502224106847,336.237199048634,335.652331213774,335.372233237891,334.768912006785,334.465821968868,333.836069823044,332.879061463386,332.177821912855,331.149647746517,330.365929236016,329.256614164233,328.378233088285,327.177396209075,326.191978744668,324.890248386789,323.786203664104,322.375611832985,321.142858389841,319.618453023858,318.249996812856,316.611073707966,315.104313238757,313.757856956849,312.136890015186,310.652499126203,309.332477569191,307.733129049689,306.274641704770,304.562237044391,302.965240605961,301.510101292255,299.800521690586,298.207460742922,296.757436018097,295.052056093782,293.464412479050,292.021147594060,290.321290432629,288.740605988646,287.305953485571,285.613277614255,284.041665012029,282.618102652465,280.934510936054,279.374229358801,277.964576510625,276.292518889020,274.746696390536,273.354899713909,271.697908622288,270.171088574612,268.802894910858,267.166135715519,265.664931006067,264.328646635337,262.719685901782,261.253713870535,259.961294373150,258.391182840223,256.974302338522,255.742701858876,254.729638361538,253.410501495731,252.295883910776,251.419656124000,250.229839277543,249.267824844847,248.567955030049,247.549327512860,246.786681233915,246.313847729305,245.521992035200,245.018450150511,244.834181153124,244.338841289269,244.165851538828,243.685282693434,243.532050574219,243.731784048602,243.647415531341,243.922476779917,244.567897498176,244.969524200026,245.743195313055,246.287762112566,247.203634619400,247.907782560903,248.978391100723,249.857455905273,251.092258859949,252.158460006727,253.032921194562,254.265494194227,255.330550623177,256.735859925079,258.000302048278,259.576374371772
};

int main(int argc, char** argv)
{
	//initialize ros 
	ros::init(argc, argv, "gnc_node");
	ros::NodeHandle gnc_node("~");
	
	//initialize control publisher/subscribers
	init_publisher_subscriber(gnc_node);

  	// wait for FCU connection
	wait4connect();

	//wait for used to switch to mode GUIDED
	set_mode("GUIDED");

	//create local reference frame 
	initialize_local_frame();

	//request takeoff
	takeoff(3);

	std::vector<gnc_api_waypoint> waypointList;
	gnc_api_waypoint nextWayPoint;


	for (int i = 0; i < 499; i++) {
		nextWayPoint.x = ((xList[i] - xList[0]) / 20);
		nextWayPoint.y = ((yList[i] - yList[0]) / 20);
		nextWayPoint.z = 3;
		nextWayPoint.psi = 0;
		waypointList.push_back(nextWayPoint);


	}

	ros::Rate rate(2.0);
	int counter = 0;
	while(ros::ok())
	{
		ros::spinOnce();
		rate.sleep();
		if(check_waypoint_reached(1) == 1)
		{
			if (counter < waypointList.size())
			{
				set_destination(waypointList[counter].x,waypointList[counter].y,waypointList[counter].z, waypointList[counter].psi);
				counter++;	
			}else{
				//land after all waypoints are reached
				land();
			}	
		}	
		
	}
	
	return 0;

}