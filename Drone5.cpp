#include <gnc_functions.hpp>
#include <math.h>
//include API 


double xList [499] = {
185.075808340961,186.717438652152,188.326336351255,189.899519529224,191.433844163241,193.258120004234,195.067471584620,196.860582334682,198.635128469884,200.390175466633,202.341535515031,204.288707610266,206.230708233132,208.167108091815,210.097837144238,212.022457114515,213.940495406828,215.940475280910,217.940428387390,219.940311524432,221.940115160314,223.939815355734,225.939426111762,227.938931907437,229.938370045775,231.937731898641,233.937074213266,235.936325549491,237.935472646776,239.934527093958,241.933518297728,243.932435636263,245.931266384004,247.868714004778,249.867752396224,251.803649447932,253.802864302450,255.737296735314,257.736659104498,259.669730645557,261.669213857243,263.601049162504,265.600628856640,267.531376725638,269.531030838736,271.460867231818,273.460575862824,275.389706419685,277.389451489930,279.318113146454,281.317877760765,283.246339360473,285.246106750233,287.174668092923,289.174420085290,291.103409286111,293.103124240345,295.032893187042,297.032543412891,298.962132642352,300.961797557836,302.891151866539,304.890908355042,306.819829311169,308.819611565838,310.746958948312,312.746768613686,314.673606517835,316.673441157671,318.599789286640,320.599645729399,322.525544970532,324.525419432305,326.450934603890,328.450822817600,330.376044683392,332.375941968450,334.300988425982,336.300889643307,338.225905741607,340.225805072834,342.150962065890,344.150852569320,346.076345584235,348.076266796825,350.000791629539,352.000705225255,353.925575575698,355.925515150876,357.849464328022,359.849429510132,361.772266389163,363.772252694728,365.693797463274,367.693796008897,369.613885354794,371.613882981110,373.532375680589,375.532355544227,377.449138343553,379.449080991934,381.364074625063,383.363959519770,385.277124652554,387.276932053353,389.188274895698,391.187987964392,393.097565250338,395.097172187678,397.005095115845,399.004591098281,400.911027998678,402.910416711055,404.815594189268,406.814888701764,408.719090766074,410.718313562449,412.621878543371,414.621060550597,416.522931679389,418.521942494110,420.422003760902,422.420817476901,424.318977800537,426.317569600247,428.213767848853,430.212115622447,432.106325676437,434.104411852681,435.996647520645,437.994461010312,439.884780573840,441.882318695718,443.770828830231,445.768099052597,447.654957689201,449.651979030508,451.537397298186,453.534201223389,455.418443827066,457.415074449591,459.298458326379,461.294971783283,463.177862811637,465.174041885865,467.055012227151,469.050821301684,470.929759844129,472.925165633775,474.801986986432,476.796960439840,478.671611137158,480.666129630877,482.538594453898,484.532644198105,486.402952376308,488.396530911343,490.264761925180,492.257880564671,494.124169366895,496.116855367294,497.981396198238,499.973694382443,501.836743331280,503.828717107960,505.690593046463,507.682324483323,509.543407838712,511.534996640632,513.395725815210,515.387287076301,517.246392225043,519.237529816044,521.094915905483,523.085600934064,524.941200424263,526.931411094246,528.785189544389,530.774913237193,532.626874766863,534.616110171047,536.466302558070,538.455061728361,540.303580897620,542.291891076254,544.138884528793,546.126789604040,547.972459001432,549.960020457164,551.804622664468,553.791919808247,555.635766259357,557.622895602329,559.466349760362,561.452880472050,563.294221808506,565.280086634040,567.119137974796,569.104275117043,570.940888804623,572.925244708274,574.759309978626,576.742842458091,578.574292952811,580.556974568353,582.385795738693,584.367617279922,586.193853392451,588.174827284582,589.998587698674,591.978751109400,593.800215360076,595.779632674965,597.599054140638,599.577818767100,601.395526659258,603.373761710992,605.190160784515,607.168018472676,608.983586238210,610.961245785600,612.774548828568,614.751375408679,616.562299788509,618.538249043590,620.346718893147,622.321760847688,624.127744872727,626.101867034503,627.905384764170,629.878595178838,631.679722713104,633.652052806859,635.450927780052,637.422434763837,639.219260014052,641.190028701454,642.985074894548,644.955218758685,646.748825180354,648.718486352385,650.511059580237,652.480407686392,654.272418284427,656.240828855889,658.030406634264,659.997814125760,661.784832784505,663.751183267553,665.535551552612,667.500805940204,669.282474304442,671.246611763758,673.025579122020,674.988600480543,676.764920327112,678.726851314000,680.500637397821,682.461531600018,684.232962715191,686.192904015066,687.962227472535,689.921331636722,691.688865287420,693.647280805639,695.413413418647,697.371321121043,699.136510569723,701.094121937277,702.858891062680,704.816445110749,706.579140886675,708.535752842694,710.296226844473,712.251831035593,714.009962221068,715.964505674953,717.720206867068,719.673652597679,721.426877029253,723.379207409421,725.129955134281,727.081175233656,728.829499178546,730.779639920070,732.525651325988,734.474772292250,736.218645274022,738.166836929056,739.908811635238,741.856196842095,743.596581551023,745.543316238953,747.282487572732,749.228760273171,750.967161428802,752.913191569562,754.651328344419,756.596290790344,758.332068055510,760.275873135515,762.009127058980,763.951697102256,765.682294871366,767.624900394229,769.356251679052,771.299666664974,773.033703752282,774.978738342241,776.717118906681,778.664379262328,780.408165390739,782.357950033457,784.107403354109,786.059650906787,788.012282949623,789.769117090177,791.725204729189,793.681304219411,795.676223017701,797.671141815991,799.666060614281,801.660979412571,803.655898210861,805.650817009151,807.645735807441,809.640654605731,811.635573404021,813.630492202311,815.625411000601,817.620329798891,819.615248597181,821.610167395471,823.605086193761,825.600004992051,827.594923790341,829.589842588631,831.584761386921,833.579680185211,835.574598983501,837.569517781791,839.564436580081,841.559355378371,843.554274176661,845.549192974951,847.544111773241,849.539030571531,851.533949369820,853.528868168110,855.523786966400,857.518705764690,859.513624562980,861.508543361270,863.503462159560,865.498380957850,867.493299756140,869.488218554430,871.483137352720,873.478056151010,875.472974949300,877.467893747590,879.462812545880,881.457731344170,883.452650142460,885.447568940750,887.442487739040,889.437406537330,891.432325335620,893.427244133910,895.422162932200,897.417081730490,899.412000528780,901.406919327070,903.401838125360,905.396756923650,907.391675721940,909.386594520230,911.381513318520,913.376432116810,915.371350915100,917.366269713390,919.361188511680,921.356107309970,923.351026108260,925.345944906549,927.340863704839,929.335782503129,931.330701301419,933.325620099709,935.320538897999,937.315457696289,939.310376494579,941.305295292869,943.300214091159,945.295132889449,947.290051687739,949.284970486029,951.279889284319,953.274808082609,955.269726880899,957.264645679189,959.259564477479,961.254483275769,963.249402074059,965.244320872349,967.239239670639,969.234158468929,971.229077267219,973.223996065509,975.218914863799,977.213833662089,979.208752460379,981.203671258669,983.198590056959,985.193508855249,987.188427653539,989.183346451829,991.178265250119,993.173184048409,995.168102846699,997.163021644989,999.157940443278,1001.15285924157,1003.14777803986,1005.14269683815,1007.13761563644,1009.13253443473,1011.12745323302,1013.12237203131,1015.11729082960,1017.11220962789,1019.10712842618,1021.10204722447,1023.09696602276,1025.09188482105,1027.08680361934,1029.08172241763,1031.07664121592,1033.07156001421,1035.06647881250,1037.06139761079,1039.05631640908,1041.05123520737,1043.04615400566,1045.04107280395,1047.03599160224,1049.03091040053,1051.02582919882,1053.02074799711,1055.01566679540,1057.01058559369,1059.00550439198,1061.00042319027,1062.99534198856,1064.99026078685,1066.98517958514,1068.98009838343,1070.97501718172,1072.96993598001,1074.96485477830,1076.95977357659,1078.95469237488,1080.94961117317,1082.94452997146,1084.93944876975,1086.93436756804,1088.92928636633,1090.92420516462,1092.91912396291,1094.91404276120,1096.90896155949,1098.90388035778,1100.89879915607,1102.89371795436,1104.88863675265,1106.88355555094,1108.87847434923,1110.87339314752,1112.86831194581,1114.86323074410,1116.85814954239,1118.85306834068,1120.84798713897,1122.84290593726,1124.83782473555,1126.83274353384,1128.82766233213,1130.82258113042,1132.81749992871,1134.81241872700,1136.80733752529,1138.80225632358,1140.79717512187,1142.79209392016,1144.78701271845,1146.78193151674,1148.77685031503,1150.77176911332,1152.76668791161
};
double yList [499] = {
122.638776201702,123.781164017367,124.969207869175,126.204155110379,127.487061154269,128.306827984514,129.159029168832,130.044892498026,130.967381529961,131.926448805602,132.364848123024,132.821488935412,133.299645375072,133.800000836010,134.321810500668,134.865720392111,135.432402939243,135.441375300437,135.455070988826,135.476691307436,135.504716615858,135.539345049791,135.578801663640,135.623260330537,135.670664243435,135.721183361662,135.772469899375,135.827188219910,135.885590988812,135.947083404621,136.010598499299,136.076397235623,136.144775901054,135.648493001131,135.710505173534,135.208207846057,135.264243240904,134.756334624435,134.806833304498,134.293769549054,134.339232569023,133.821533473653,133.862534044379,133.340794007235,133.377988468799,132.852887053893,132.887024878689,132.359336244566,132.391268266585,131.861868403859,131.892552069764,131.362423916910,131.392926160347,130.863160978892,130.894656518637,130.366451385079,130.400216778768,129.874867549813,129.912270414188,129.386261473630,129.422870567902,128.896000610999,128.927209370863,128.398755072921,128.428266662318,127.894101830760,127.921693537407,127.385693825528,127.411411782550,126.873654508291,126.897617153216,126.358254461695,126.380662878648,125.839930667664,125.861076179360,125.319300610073,125.339570025866,124.797171522600,124.817049171908,124.274542931129,124.294609444435,123.752603400106,123.773531235418,123.232720132062,123.250472411655,122.706225989282,122.724816569529,122.181793426391,122.197339989975,121.651062071917,121.662863357830,121.112683081340,121.120084267174,120.565408053086,120.567820003627,120.008126423379,120.005045071039,119.439902821649,119.430928132719,118.860013340295,118.844867278556,118.267979607450,118.246522489252,117.663599531478,117.635844176808,117.046973614616,117.013096736185,116.418525807699,116.378876140114,115.779017740009,115.734119897944,115.129555306852,115.080110622377,114.471588826130,114.418471481456,113.806904233904,113.751152906995,113.137605546632,113.080410249766,112.461632252851,112.398737399074,111.774424030294,111.705549298125,111.075479948152,111.000441170628,110.364491328279,110.283212943864,109.641365398600,109.553891789429,108.906246688399,108.812751979970,108.159535363722,108.060331272862,107.401901723222,107.297442837283,106.634295428727,106.525181899037,105.857950338103,105.744927843459,105.074383429951,104.958339657190,104.285387078878,104.167344644139,103.493014327941,103.369446113524,102.689776653268,102.560369783246,101.875103445450,101.739620108293,101.048576252804,100.906869089259,100.209958217595,100.061985320715,99.3592225680369,99.2050615560212,98.4965791507706,98.3364397594734,97.6224979698729,97.4567328079254,96.7377292566882,96.5668418557029,95.8433175024563,95.6679665822594,94.9406093012510,94.7616107732659,94.0312560720252,93.8495808579146,93.1172088593410,92.9339766458331,92.2007052507319,92.0171739364484,91.2797947626719,91.0917227187565,90.3500240503203,90.1572207386650,89.4110635622127,89.2134237658988,88.4627537599804,88.2602701154722,87.5051287428662,87.2979030042571,86.5384373164191,86.3266899136491,85.5631606863875,85.3472379373710,84.5800253291084,84.3604042649861,83.5900118484025,83.3673024869209,82.5943583124773,82.3693026253048,81.5945573350775,81.3680248334343,80.5923465707317,80.3606231763173,79.5799426509688,79.3425802809354,78.5565203811410,78.3131471565018,77.5214084605970,77.2717453923530,76.4741210546540,76.2179982268779,75.4143881937214,75.1517599176512,74.3421840244100,74.0731424314931,73.2577519352929,72.9825384932238,72.1616256159989,71.8806400882186,71.0546449408315,70.7684507872934,69.9379656698773,69.6472930824839,68.8130640858726,68.5188089583249,67.6817340478747,67.3849530421096,66.5460765978373,66.2479780996572,65.4042174260277,65.1006442517101,64.2517903829343,63.9425582026133,63.0884874776476,62.7735124345041,61.9141977649540,61.5935083663368,60.7290294488521,60.4027770014345,59.5333291276041,59.2017963218827,58.3276974540091,57.9913045098346,57.1129998814800,56.7723082602839,55.8903733620849,55.5460869194202,54.6612276062265,54.3141903353277,53.4272398165340,53.0784303602599,52.1903436434743,51.8362817531838,50.9433028199798,50.5837089345981,49.6856196777310,49.3202899939993,48.4169463034394,48.0457654956782,47.1371083326757,46.7600618621819,45.8461279815112,45.4633132143180,44.5442442274166,44.1558799619498,43.2319303265037,42.8383646676975,41.9099079890109,41.5116240437607,40.5791571527405,40.1767756498548,39.2409205362560,38.8352006106932,37.8967041571723,37.4885406741197,36.5482714518913,36.1386890625917,35.1976311823199,34.7877749283841,33.8428391625614,33.4285087949007,32.4794401519358,32.0603790016548,31.1069773367419,30.6829963384923,29.7251271804094,29.2961169502792,28.3337219728757,27.8996642731708,26.9327711022888,26.4937493217418,25.5224803663409,25.0786886491481,24.1032686522229,23.6550193255329,22.6757813445254,22.2235101037255,21.2408992331253,20.7851681105169,19.7997438034636,19.3412418352978,18.3536776238369,17.8932185317031,16.9042992113840,16.4428160684068,15.4534321429807,14.9874696080694,13.9939519757486,13.5231847180248,12.5252714769081,12.0494336610884,11.0469211367021,10.5712281868465,9.57001755539014,9.09764250048442,8.10109075579708,7.63542945843346,6.64647394215482,6.19020964667944,5.21081700919345,4.76546338900026,3.79623014624560,3.36180006779639,2.92910143677030,1.97331181421638,1.55651312359312,1.13977005604085,1.28224457386556,1.42471909169028,1.56719360951500,1.70966812733971,1.85214264516443,1.99461716298915,2.13709168081386,2.27956619863858,2.42204071646330,2.56451523428802,2.70698975211273,2.84946426993745,2.99193878776217,3.13441330558688,3.27688782341160,3.41936234123632,3.56183685906103,3.70431137688575,3.84678589471047,3.98926041253518,4.13173493035990,4.27420944818462,4.41668396600933,4.55915848383405,4.70163300165877,4.84410751948348,4.98658203730820,5.12905655513292,5.27153107295763,5.41400559078235,5.55648010860707,5.69895462643178,5.84142914425650,5.98390366208121,6.12637817990593,6.26885269773065,6.41132721555536,6.55380173338008,6.69627625120480,6.83875076902951,6.98122528685423,7.12369980467895,7.26617432250366,7.40864884032838,7.55112335815310,7.69359787597781,7.83607239380253,7.97854691162724,8.12102142945196,8.26349594727668,8.40597046510139,8.54844498292611,8.69091950075083,8.83339401857554,8.97586853640026,9.11834305422498,9.26081757204969,9.40329208987441,9.54576660769913,9.68824112552384,9.83071564334856,9.97319016117328,10.1156646789980,10.2581391968227,10.4006137146474,10.5430882324721,10.6855627502969,10.8280372681216,10.9705117859463,11.1129863037710,11.2554608215957,11.3979353394204,11.5404098572452,11.6828843750699,11.8253588928946,11.9678334107193,12.1103079285440,12.2527824463687,12.3952569641935,12.5377314820182,12.6802059998429,12.8226805176676,12.9651550354923,13.1076295533170,13.2501040711418,13.3925785889665,13.5350531067912,13.6775276246159,13.8200021424406,13.9624766602653,14.1049511780901,14.2474256959148,14.3899002137395,14.5323747315642,14.6748492493889,14.8173237672136,14.9597982850384,15.1022728028631,15.2447473206878,15.3872218385125,15.5296963563372,15.6721708741619,15.8146453919866,15.9571199098114,16.0995944276361,16.2420689454608,16.3845434632855,16.5270179811102,16.6694924989349,16.8119670167597,16.9544415345844,17.0969160524091,17.2393905702338,17.3818650880585,17.5243396058832,17.6668141237080,17.8092886415327,17.9517631593574,18.0942376771821,18.2367121950068,18.3791867128315,18.5216612306563,18.6641357484810,18.8066102663057,18.9490847841304,19.0915593019551,19.2340338197798,19.3765083376046,19.5189828554293,19.6614573732540,19.8039318910787,19.9464064089034,20.0888809267281,20.2313554445529,20.3738299623776,20.5163044802023,20.6587789980270,20.8012535158517,20.9437280336764,21.0862025515012,21.2286770693259,21.3711515871506,21.5136261049753,21.6561006228000,21.7985751406247,21.9410496584495,22.0835241762742,22.2259986940989,22.3684732119236,22.5109477297483,22.6534222475730,22.7958967653978,22.9383712832225,23.0808458010472,23.2233203188719,23.3657948366966,23.5082693545213,23.6507438723461,23.7932183901708,23.9356929079955,24.0781674258202,24.2206419436449,24.3631164614696,24.5055909792944,24.6480654971191,24.7905400149438,24.9330145327685,25.0754890505932,25.2179635684179,25.3604380862427,25.5029126040674,25.6453871218921,25.7878616397168,25.9303361575415,26.0728106753662,26.2152851931909,26.3577597110157,26.5002342288404,26.6427087466651,26.7851832644898
};

int main(int argc, char** argv)
{
	//initialize ros 
	ros::init(argc, argv, "gnc_node");
	ros::NodeHandle gnc_node("~");
	
	//initialize control publisher/subscribers
	init_publisher_subscriber(gnc_node);

  	// wait for FCU connection
	wait4connect();

	//wait for used to switch to mode GUIDED
	set_mode("GUIDED");

	//create local reference frame 
	initialize_local_frame();

	//request takeoff
	takeoff(3);

	std::vector<gnc_api_waypoint> waypointList;
	gnc_api_waypoint nextWayPoint;


	for (int i = 0; i < 499; i++) {
		nextWayPoint.x = ((xList[i] - xList[0]) / 20);
		nextWayPoint.y = ((yList[i] - yList[0]) / 20);
		nextWayPoint.z = 3;
		nextWayPoint.psi = 0;
		waypointList.push_back(nextWayPoint);


	}

	ros::Rate rate(2.0);
	int counter = 0;
	while(ros::ok())
	{
		ros::spinOnce();
		rate.sleep();
		if(check_waypoint_reached(1) == 1)
		{
			if (counter < waypointList.size())
			{
				set_destination(waypointList[counter].x,waypointList[counter].y,waypointList[counter].z, waypointList[counter].psi);
				counter++;	
			}else{
				//land after all waypoints are reached
				land();
			}	
		}	
		
	}
	
	return 0;

}