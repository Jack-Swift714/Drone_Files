#include <gnc_functions.hpp>
#include <math.h>
//include API 


double xList [499] = {
101.063674995929,102.875224330675,104.834256576045,106.601419549662,108.367769741415,110.133248765483,112.090721048229,113.856300641331,115.620883506141,117.383749035040,119.141058240573,120.891426532367,122.637134398784,124.377398576660,126.111497712286,127.831895407195,129.531744026846,131.208154958845,133.120561432052,135.025899835274,136.925357942371,138.924443235176,140.923660543042,142.923033196661,144.851189656350,146.772091699580,148.684730616882,150.588584254588,152.481536101164,154.362119069044,156.355171215228,158.207666341814,160.191504401811,162.005141264132,163.972265024476,165.731034055421,167.669632177880,169.346222954487,171.228874347996,173.061020577881,174.829612485828,176.753711588522,178.378885196658,180.309494274684,181.929701260075,183.732734205175,185.602580345774,187.301210444949,189.251443251936,191.055262739058,192.621788481075,194.503367031412,196.181356230777,197.904789205284,199.352294426050,201.167567408222,202.756259860519,204.650624128170,206.353579726379,207.762441886290,209.562238155239,211.119990261828,213.006271235934,214.692751790117,216.441054383676,217.918148034028,219.759623962253,221.377647212985,223.068770272040,224.819385464572,226.326975285414,228.182842959654,229.847076971106,231.572170608110,233.047187286505,234.884627940185,236.529358410065,238.241644659250,240.028441326480,241.573393237445,243.456713194318,245.143008403031,246.893400197836,248.691938965536,250.537757072641,252.145305265846,254.049001241409,255.743232185631,257.479609728319,258.921640489124,260.730510764729,262.282659838093,264.158343027607,265.811938563971,267.517459627070,268.928560129395,270.727700110936,272.283921780129,274.170858482888,275.859281332569,277.610106844658,279.094606479398,280.943488598615,282.578774463477,284.504560873634,286.253880184253,288.053021783536,289.593391762051,291.464888382040,293.115982108261,295.042646175597,296.782184232408,298.743953612448,300.724334620431,302.723865382495,304.706591349053,306.696546298801,308.690816700917,310.683984438947,312.671114266762,314.644207713017,316.590266066234,318.490024549857,320.317232686746,322.036624661646,323.608292426128,324.987051936872,326.127066412719,327.523623656325,328.685964835748,330.103843612793,331.292939891619,332.736239861963,333.957326674912,335.430759233980,336.689851726542,338.198714349668,339.503003341116,341.053641657472,342.411407151858,344.010639106610,345.430988209320,347.085989562301,348.579105128310,350.296840916306,351.869890491981,353.651451708967,355.309406851686,357.156513948341,358.901374776546,360.808215067462,362.637497805583,364.595590663197,366.501119127270,368.492610613242,370.457042981427,372.372208520371,374.366682489385,376.338258194844,378.334984400155,380.334222133130,382.291753269229,384.274431061898,386.136676172104,388.041759168819,389.983869362711,391.749968923503,393.566765899140,395.430882044563,397.054263634903,398.733480952927,400.467386653949,402.253821544472,403.752378805339,405.309112375791,406.923941806845,408.179235927696,409.489642380274,410.856701069384,412.281618663988,413.765230901097,414.847513372305,415.982859587275,417.170804453665,418.410694060368,419.704228769260,421.053513979576,421.964807007620,422.923124533132,423.928253236295,424.979789106432,426.077195378598,427.220643681086,428.412752469868,429.656161878701,430.953410379861,431.799514536901,432.690704947575,433.627049691622,434.609480376533,435.638895346538,436.716157849119,437.842106252079,439.017550472707,440.243260436188,441.520018793328,442.337715083592,443.195190010568,444.093402658817,445.033346637827,446.016156011937,447.043016893875,448.115172696340,449.233919129703,450.400603244644,451.616596758109,452.883349305519,454.202290457089,455.574794217951,457.002128426975,458.485934220471,460.027500538938,461.627674171506,462.866860007095,464.163159086380,465.517191007532,466.929440530454,468.400244448087,469.929741682018,471.517863034568,473.164193528358,474.867861312276,476.627384607936,478.440619498013,480.304236374633,482.213416630482,484.161461132281,486.139370375494,488.135389738678,490.134552504661,492.096756361827,494.084641387920,496.084302598681,498.077793870038,500.042690040392,501.951731306358,503.941735056723,505.897715865770,507.790085598344,509.583698495127,511.512071270773,513.358591938380,515.083730843903,516.643317439888,518.396928979851,519.993869697345,521.775994939826,523.409321668976,524.845381008915,526.491728423179,527.943261370374,529.601808052675,531.067620066892,532.289998805042,533.743317990900,534.950390601645,536.390145901537,537.580909466069,539.005810103185,540.178387934004,541.586374200212,542.738022155293,544.126346470805,545.253648243437,546.618881347571,547.717621425924,549.055634992365,550.120915322052,551.427422421813,552.455954200990,553.728601520082,554.717347554690,555.952646514210,557.418220923647,558.640197210838,560.092598755897,561.297074262064,562.732633323081,563.915448961377,565.330462478130,566.488466343970,567.880902140480,569.011929721671,570.380063322745,571.483463220913,572.827732843326,574.393121246549,575.742206539789,577.311577525466,578.665463635410,580.239552737535,581.599851782436,583.180805474758,584.552112856516,586.144411716208,587.923497640818,589.554698521011,591.364956192926,593.039279699248,594.883374838041,596.605674460004,598.485685356294,600.260292973264,602.176849841103,604.168935823856,606.129132666338,608.129088822728,610.119647830073,612.076383049798,614.076382740873,616.028614617207,618.011139920936,620.009604900194,621.941060241938,623.908891960897,625.742231933231,627.628150860897,629.559520218299,631.314430513102,633.127758235232,634.681170984534,636.297417576599,637.976259196296,639.716229963697,641.156711836481,642.659148165548,644.224351583316,645.852411930987,647.133026931585,648.472136398093,649.871456355273,651.332234575888,652.390258713436,653.498133431410,654.657987847784,655.871765930526,657.141301185601,658.468206071266,659.853577911508,660.813127097064,661.818138347562,662.870062012334,663.970263829779,665.120079005894,666.321458261195,667.576203058128,668.373447347427,669.206385813806,670.075553956715,670.981369442182,671.925141569368,672.908116988564,673.931497893653,674.996546475412,676.104410534941,677.256158479888,678.453607969639,679.698490913500,680.992492530343,681.833935187125,682.706990168538,683.611578903982,684.547454663036,685.515241353563,686.515454353674,687.548504447404,688.614684602910,689.714214036479,690.847151784564,692.013374393873,693.213534135266,694.448194871728,695.717772370657,697.022516541621,698.362499209170,699.737644758891,701.147649674763,702.591985800787,704.070658867930,705.583535217623,707.130196038268,708.710199884344,710.322832221879,711.967393118623,713.643664654059,715.351155679044,717.089124842620,718.856503166474,720.651964674405,722.474220845466,724.322331982149,726.195051804589,728.090873779354,730.008038296711,731.945302392851,733.900615332319,735.871912968673,737.856907273900,739.855200858329,741.814648909618,743.610744056356,745.123531041193,746.683052336582,748.283276643333,749.916059087781,751.581288712970,752.884018082902,754.196657809861,755.881362541350,757.185206182772,758.858031075921,760.136473286064,761.794997228919,763.059049584342,764.326572856085,765.975331907341,767.226983156013,768.484813851580,769.741801944075,771.378445218977,772.616745327916,773.869316578142,775.128603353805,776.395437703186,777.169740299457,778.434701713023,779.676456958874,781.292422227832,782.487209893471,783.677524764321,784.852844644895,786.012644245410,787.565754045905,788.679886183895,789.787617704771,791.305960698244,792.373098929000,793.429285254458,794.908866821742,795.932577952536,797.392525751540,798.390819491348,799.825985170764,801.240011576202,802.632082725137,804.004584224642,805.716723169261,807.045735249986,808.366651297361,810.043489999990,811.329058984586,812.983852104936,814.243893918476,815.884673784419,817.514776947592,819.396209586760,821.002572246212,822.613515888399,824.487757131279,826.081711109971,827.950229034146,829.536490066566,831.400708469862,833.391086898393,835.238717086077,837.225595032901,839.063262157325,841.047957295620,843.025856129529,845.004424965112,846.986878368600,848.961357613754,850.946547303088,852.794468309599,854.785538668759,856.648108608435,858.641037192189,860.500664989158,862.366009367162,863.969510799356,865.853120216051,867.476262702794,869.363482528662,870.979284449859,872.854971986725,874.438290741736,876.033002292999,877.242647368160,878.865885395820
};
double yList [499] = {
185.173904585212,184.326385259309,183.923653758678,182.987098888594,182.049012005574,181.109286611867,180.699040024704,179.759503596233,178.818096504047,177.873477466012,176.918561576444,175.950981686677,174.975018549499,173.989381399631,172.992937629104,171.973020097460,170.919210498780,169.828501377579,169.243094270313,168.635076532736,168.008930464008,167.948449127290,167.892501330831,167.842411491955,168.373648413639,168.930546375850,169.515193595994,170.127844659971,170.773393501303,171.454134054614,171.620696783313,172.374528200787,172.628273253364,173.471316153595,173.832458939056,174.784683437685,175.276453017466,176.366885669122,177.041884728765,177.843907292237,178.777760954832,179.323510570512,180.489190948411,181.011444323551,182.184018126980,183.049507698774,183.759208629086,184.814981230634,185.258368193175,186.122217287566,187.365598604619,188.043582497431,189.131861986722,190.146642151281,191.526761217106,192.366275362431,193.581205933292,194.222598185698,195.271379492993,196.690924284245,197.563124599699,198.817480360404,199.482269113865,200.557342758022,201.528650145699,202.877054516831,203.657417512986,204.833002797043,205.900758761266,206.867891868794,208.182111383218,208.927601272961,210.036801505167,211.048756021718,212.399432074093,213.189249675950,214.327169568319,215.360647096305,216.259177936052,217.529265961665,218.202397405026,219.277761747503,220.245299118710,221.120089551373,221.890125599546,223.079994838799,223.693135632277,224.755953353074,225.748421503318,227.134259619726,227.987481938958,229.248764323697,229.942891525712,231.067890104429,232.112494289432,233.529814074215,234.403367350681,235.659621352200,236.322546596690,237.394567249790,238.361319558409,239.701566115747,240.464216041493,241.615667360561,242.155432774841,243.124907864515,243.998457809124,245.274098953526,245.979436037032,247.108103174515,247.644727411423,248.631645517906,249.020825295823,249.300273078459,249.343594338328,249.081301102539,248.881102955770,248.729823204169,248.564649452994,248.338121204408,248.011162105517,247.549797947965,246.924563828694,246.111353877643,245.089741800263,243.852866528424,242.404066262157,240.760786920457,239.329134775090,237.701571264005,236.291032440148,234.682912407414,233.298396175799,231.714430584241,230.362026615791,228.808100589503,227.495342582659,225.979153205706,224.716013937118,223.247520538339,222.046497160174,220.638445873313,219.515516435801,218.184875272098,217.160480932677,215.925363516207,215.016496292608,213.897932595391,213.130993632052,212.153516936577,211.550225875034,210.741693461327,210.334419154551,209.726997330275,209.542710430841,209.167203479075,208.590886761945,208.442314937810,208.106325000990,208.220712329932,208.165499224162,208.575464894922,208.838122029713,209.567534909717,210.176352432155,210.654063636527,211.592622287528,212.428833235385,213.153451063191,214.321625798470,215.408009339789,216.404789666622,217.304039566218,218.628549338135,219.884168942405,221.064137547327,222.621133587834,224.132038922077,225.591884989486,226.995312881680,228.336541695082,230.018405141536,231.664913256351,233.273884043661,234.843174890888,236.368549584821,237.844838655844,239.625160260791,241.380616759909,243.109696367700,244.810952466532,246.482986997817,248.123878822265,249.729766936583,251.296270381209,252.818487949837,254.630698686876,256.421167801919,258.188442121400,259.930518454212,261.645250159036,263.330333391560,264.983282330236,266.601408062123,268.181798863610,269.721242950763,271.546447809646,273.353306063524,275.140262705003,276.905625363587,278.647488083253,280.363750513403,282.052087545882,283.709919388331,285.334372581237,286.922251599050,288.469939546807,289.973400300766,291.428128256921,292.829098297911,294.170112976126,295.444308128278,296.644076583286,298.213923220661,299.736949384929,301.208886053573,302.625060931549,303.980323207226,305.268980730154,306.484657730666,307.620261493084,308.667885510582,309.618715554296,310.462622677981,311.188523592140,311.784368161366,312.237272808077,312.533710028436,312.659831802109,312.601967865970,312.988951099360,313.208753563026,313.245564460586,313.084342405575,312.711269973295,312.114980240999,311.915267763839,311.497968021882,310.850714752103,309.965868564061,309.435417399345,308.667067593529,307.655190250837,306.403116111809,305.441426678099,304.237358430528,303.329597658016,302.175368999627,300.783344009846,299.647764778113,298.271882478202,297.154196071991,295.793536254484,294.210567454881,292.836572060413,291.241901024623,289.853699066537,288.246813217019,286.843368107887,285.223164037199,283.802750479756,282.167603089593,280.727965775906,279.075939531133,277.614386052338,275.943227699512,274.456715104200,272.764031489586,271.249753048125,269.534491441482,267.991647054900,266.253147334150,264.680240318269,263.319324578627,261.736045085442,260.361079721548,258.764446152113,257.371905243439,255.759160016876,254.345746861636,252.715094523857,251.279433507950,249.629955829839,248.171117096595,246.503031767626,245.022174184245,243.777361287840,242.300889523273,241.061101352127,239.589030565343,238.355238241420,236.889091417790,235.664107571884,234.208251787564,232.998051663029,232.084348607953,230.927117564273,230.076842807931,228.982932027210,228.208778864664,227.192076345643,226.509757483355,225.587386730463,225.015713946135,224.837968517734,224.440944162404,224.454186991227,224.260086918384,223.846339072603,223.845227451504,224.279727970519,224.543533618815,224.621877263628,225.140992147683,225.498257211550,226.297547237662,226.963362375873,227.482797073680,228.442114464951,229.285822099239,230.545547795693,231.723574515949,232.810538552141,233.796693574736,235.184141582476,236.504249561810,237.749295047326,238.910940218772,240.447177576813,241.932703018100,243.361654961811,244.727717548291,246.424946149383,248.090062844775,249.719399437631,251.308972577142,252.854378749034,254.350815658629,255.793294380920,257.548077946064,259.277225824752,260.978242169028,262.648438552957,264.284875249189,265.883839878233,267.441278639331,269.275509143706,271.093808764568,272.895071304941,274.678186081474,276.441505159788,278.183274181575,279.901613939335,281.594443380977,283.259567167849,284.894644129741,286.496553839898,288.061886538107,289.586865166026,291.401245020232,293.200626858372,294.984364288519,296.751887007925,298.502140967109,300.234068781542,301.946612942680,303.638729923271,305.309369029935,306.957535301573,308.582319848993,310.182200030488,311.755608072237,313.300979540270,314.816777234006,316.301515073043,317.753746017859,319.172155739068,320.555591012242,321.902263192285,323.210393595013,324.478400024762,325.704608753479,326.887578298285,328.025743249819,329.116666592446,330.158047598415,331.147725923154,332.083874341073,332.964963424842,333.789210018423,334.553726353416,335.255809301961,335.892879973079,336.462511620188,336.959510434880,337.379928451564,337.717546029461,337.962081524253,338.044681466344,337.643977917199,336.764181222579,335.455947474922,334.203792001657,333.004091135572,331.849092655442,330.741387687776,329.223858054222,327.714892532015,326.637038196912,325.120465825173,324.024264713670,322.486218708076,321.368498559302,319.818604484614,318.271547680360,317.139472775196,315.579546766791,314.024599198129,312.468970407149,311.319449293503,309.748903897724,308.189716525050,306.635947939757,305.088326948937,303.244294549708,301.695142322782,300.127327311564,298.948914714243,297.345018697029,295.737800445443,294.119584397342,292.490208784831,291.230109603177,289.569173247052,287.903961285271,286.602179984833,284.910667053620,283.212294171738,281.866620219492,280.148477175188,278.781527130680,277.048492333262,275.655546005284,274.241145310741,272.805130716002,271.350400626310,270.316679080477,268.822113294274,267.320387355301,266.230335996251,264.698241878436,263.575005603717,262.021849259967,260.878240309532,259.719463507290,259.041074810249,257.849605546558,256.664337398966,255.966326107160,254.758306772128,254.045116217622,252.827012799589,252.102658090337,251.906714957674,251.141037029587,250.912310064796,250.123019535390,249.876067701973,250.172574367703,249.880572034046,250.144917457684,249.826434003709,250.069378230561,250.834354016906,251.023136497227,251.751719519136,251.919754218102,252.655814308543,253.377264481076,254.572581659465,255.244902687948,256.413409627479,257.075528445250,258.254165009869,258.948280464275,260.170205879361,261.377224962999,262.969945526104,264.138319740797
};

int main(int argc, char** argv)
{
	//initialize ros 
	ros::init(argc, argv, "gnc_node");
	ros::NodeHandle gnc_node("~");
	
	//initialize control publisher/subscribers
	init_publisher_subscriber(gnc_node);

  	// wait for FCU connection
	wait4connect();

	//wait for used to switch to mode GUIDED
	set_mode("GUIDED");

	//create local reference frame 
	initialize_local_frame();

	//request takeoff
	takeoff(3);

	std::vector<gnc_api_waypoint> waypointList;
	gnc_api_waypoint nextWayPoint;


	for (int i = 0; i < 499; i++) {
		nextWayPoint.x = ((xList[i] - xList[0]) / 20);
		nextWayPoint.y = ((yList[i] - yList[0]) / 20);
		nextWayPoint.z = 3;
		nextWayPoint.psi = 0;
		waypointList.push_back(nextWayPoint);


	}

	ros::Rate rate(2.0);
	int counter = 0;
	while(ros::ok())
	{
		ros::spinOnce();
		rate.sleep();
		if(check_waypoint_reached(0.5) == 1)
		{
			if (counter < waypointList.size())
			{
				set_destination(waypointList[counter].x,waypointList[counter].y,waypointList[counter].z, waypointList[counter].psi);
				counter++;	
			}else{
				//land after all waypoints are reached
				land();
			}	
		}	
		
	}
	
	return 0;

}