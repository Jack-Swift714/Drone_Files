#include <gnc_functions.hpp>
#include <math.h>
//include API 


double xList [499] = {
154.750868146056,156.466629415298,158.205368498291,159.963335574452,161.744562985923,163.550181510867,165.381005047313,166.911317303468,168.490322974543,170.110075992910,171.765345124096,173.060462928681,174.449526580218,175.924977402928,177.020780205648,178.227643767017,179.550180431508,180.492747583642,181.573265316187,182.243055934859,183.051310512036,183.993521479652,185.064148352758,186.259990517975,187.577828146802,189.013925854000,190.095677150115,191.309697865707,192.651099599770,193.621545587779,194.727417298968,195.964346238958,197.326603433438,198.320372438719,199.445432121955,200.699648424055,201.567956914234,202.572369155003,203.709550814374,204.974292586771,205.850828964872,206.854434099194,207.985711866441,209.242633749884,210.110391431551,211.108090013401,212.238297133611,213.495369298021,214.872467967488,215.877562563912,217.001737536101,218.243811996088,219.600796179908,220.578345521857,221.671392762836,222.882149790693,224.210450430505,225.653594337179,226.741019837752,227.950570720877,229.279810639726,230.724475097227,232.278651766624,233.934911002439,235.293769706053,236.763756979346,238.340894981432,240.018724442761,241.788288648597,243.305992825348,244.928608248797,246.648642647752,248.454760820919,250.332531052189,252.268686547980,254.246465884539,256.116092076013,258.049524694706,260.027223728397,262.025967968631,264.019025925623,266.004504225132,268.004468834829,269.991342351284,271.933387057384,273.931321212428,275.902296044910,277.814702884747,279.632389034466,281.575000534678,283.437825126550,285.185990822884,286.780123194565,288.567727687397,290.213103713772,291.676103610960,293.358181915079,294.864381125390,296.579926273500,298.129338563300,299.471299655312,301.048595034405,302.424048889840,304.029342334659,305.438451586942,306.609569290924,308.033472215420,309.222218532424,310.662400070848,311.870079710047,313.326874637131,314.553592804088,316.026765158011,317.272388608894,318.761675810152,320.026120807074,321.029919233270,322.300405728739,323.312719146102,324.592134516416,325.615584379360,326.908114116541,327.948724090155,329.258869174503,330.320985469486,331.651934488950,332.738863834847,334.092875270255,335.206942955928,336.586812860713,337.730785541356,339.138294722873,340.315022283804,341.752653826933,342.966281511478,344.437618433215,345.693286203636,347.202215812261,348.503029161750,350.052024451738,351.402459813498,352.995613384071,354.396622358874,356.031344627478,357.479738232996,359.152264335928,360.644592573643,362.351900085992,364.219340726189,365.969455347380,367.870984024670,369.668435303473,371.599525117555,373.440155741790,375.395680711613,377.274760414145,379.249408990255,381.248471501765,383.238624255501,385.229602353274,387.228639389201,389.201052148744,391.199197758496,393.140851716560,395.126125970382,397.023125011892,398.980861219649,400.815371842069,402.726933651440,404.476274334847,406.316570818518,407.948651532653,409.684812774299,411.163006070110,412.752715689188,414.447773657549,415.868293467409,417.401553242070,419.041549694523,420.382312417310,421.836968814805,423.399962905006,424.634527864915,425.979065193137,427.432664190215,428.527296760667,429.730557905141,431.042586279315,432.461693723524,433.507870510959,434.660104172677,435.921028835714,437.288430569792,438.267916242711,439.349104750237,440.534014227280,441.823412892577,442.707521121865,443.692078254713,444.778962522621,445.968991101154,447.261801704207,448.146820310451,449.128027752655,450.208391492870,451.390159883481,452.674505387186,453.551472942534,454.524794362948,455.596771464507,456.768992753000,458.042050051557,459.415376880788,460.397566977572,461.475927539684,462.653209326101,463.931403881184,465.311332811161,466.792337971625,467.914217823153,469.136891586149,470.461274170150,471.887086663277,473.412526547412,475.034024672418,476.746001785483,478.173508919990,479.699086225513,481.320690459636,483.034034339488,484.832102442630,486.704709280601,488.377027714340,490.138280401471,491.979893433348,493.889696984342,495.851457467695,497.844457940667,499.760571766183,501.727121803408,503.722531382349,505.719468158541,507.685035046006,509.685011295702,511.669666371562,513.601903551782,515.439489217060,517.387456500188,519.249255803230,520.977477046221,522.850686780146,524.594066649484,526.156355188135,527.898593510271,529.458099802899,531.196848345704,532.751410250824,534.485629929735,536.033677756370,537.341916530051,538.862270623121,540.135120814561,541.622756728856,542.854171297617,544.303142467485,545.486030296414,546.889448448353,548.016034833828,549.366294869004,550.428191828368,551.717019588803,553.215314650966,554.456633357990,555.911696827647,557.100054654762,558.506914210153,559.637527364846,560.991818229663,562.058648809475,563.352871483167,564.348545467233,565.575599185449,567.019234217233,568.195906697670,569.594501310908,570.716462811493,572.064393329495,573.126311054678,574.418648931406,575.416294936156,576.647414698307,578.097502133507,579.283782270146,580.693406628355,581.832071283894,583.197075121984,584.768230312668,586.104737472939,587.651004977694,588.957292437370,590.477557444506,591.753550989479,593.246333508809,594.930205424386,596.413309996252,598.089799083401,599.565084775557,601.234954035866,603.063922721659,604.744797831706,606.582789960943,608.277816451426,610.127476433274,612.082569882270,613.958321858170,615.928155280693,617.831318418044,619.814838821244,621.810601927135,623.807335203976,625.787547850544,627.786978619771,629.735789339961,631.722342042634,633.617992488599,635.569381024381,637.382766141940,639.268222364369,640.961566477584,642.740161424220,644.595328656473,646.237349300034,647.967562003479,649.421861392376,650.971196062971,652.613351711072,653.944054796529,655.370681175105,656.893069100516,658.064001143962,659.328969211093,660.689633107057,662.146266825047,663.230751795962,664.407127339279,665.677602760714,667.043413281300,668.012572280657,669.070283374573,670.219262491687,671.461588292553,672.798378514249,673.729858061716,674.748009850296,675.856097396318,677.056320935882,678.350051927063,679.228120220760,680.190455128811,681.240545983163,682.381051951007,683.613945321822,684.940309204779,685.857731686560,686.860603596415,687.952285084215,689.135060568525,690.410475821320,691.779292394616,692.749178561168,693.805584410016,694.951520527643,696.189528388437,697.520853937056,698.945688028762,699.986593648038,701.115352655571,702.334766544479,703.647045534075,705.053579858572,706.553801097953,708.145748808125,709.404794998813,710.755917972547,712.200287582313,713.738004614995,715.367583514596,717.085494736317,718.884916985786,720.439339607900,722.084549314037,723.817249822416,725.631409117605,727.517564306600,729.461611999337,731.260853053711,733.134397314422,735.069816871143,737.049277528612,739.048739523355,741.037678921396,743.030219873188,745.028705082254,746.998445428405,748.897976089334,750.878009784585,752.797434351750,754.608865700642,756.536714984692,758.360600265593,760.027106990687,761.847399097352,763.507870018799,765.322427589733,766.973144426128,768.401595515459,770.018559721693,771.403039279353,772.980654627184,774.314363213195,775.845954044965,777.121167783403,778.599513798537,779.808661523501,781.226652183048,782.361905441872,783.711204466262,784.764351441485,786.036171710760,787.513872797663,788.723570076815,790.143463922901,791.281810132467,792.634563525270,793.691589177713,794.968338915116,795.935244887371,797.126847659128,798.532485756236,799.655752531582,800.997418089860,802.044211124898,803.313932221109,804.276587410099,805.467979000850,806.876510475585,808.007763679037,809.361169088657,810.426589803317,811.719304023330,813.223603113731,814.474822947952,815.941346780891,817.146920307690,818.571904201327,819.728073139208,821.109376428508,822.695562497853,824.053657846366,825.620053156427,826.953642903216,828.499028437538,830.228059069389,831.773579996775,833.503372089746,835.050410609240,836.782478886816,838.334415281814,840.071712299118,841.953737263704,843.715875303871,845.616036829010,847.406285825215,849.326186621479,851.148320165448,853.089628587450,855.087048980865,857.056420149833,859.055971109944,861.046379044603,863.035653001131,865.035569546817,866.996369307366,868.987735483267,870.894301848866,872.850437294127,874.668374007046,876.552944440165,878.239064284833,880.005161551823,881.844513130941,883.455484086066,885.150286662260,886.924080067130,888.433568206713,890.029577464573,891.709370304432,893.082491211669,894.542817850139
};
double yList [499] = {
201.863262441662,202.890960484363,203.879285532751,204.832989763178,205.742511015609,206.602593420021,207.407630797038,208.695320355380,209.922814180502,211.096014998560,212.218549676573,213.742580474243,215.181504437481,216.531706226016,218.204792062891,219.799621315269,221.299920209182,223.063883690583,224.746881441519,226.631392127915,228.460797642958,230.224951403974,231.914258391642,233.517368342920,235.021796468172,236.413781875919,238.095987016011,239.685374854807,241.168830748272,242.917611633448,244.584059279908,246.155684807002,247.620012412454,249.355645773548,251.009199736730,252.567064129913,254.368741228032,256.098237122965,257.743478100327,259.292809649465,261.090498159153,262.820462532879,264.469768633436,266.025450920705,267.827393374256,269.560770869141,271.210810827877,272.766371682831,274.216750686592,275.945850120471,277.600005685073,279.167567816488,280.636783227810,282.381603357237,284.056490735238,285.648366176186,287.143564293586,288.528243196664,290.206785951765,291.799578047782,293.293941202486,294.677033609101,295.935816704117,297.056890004031,298.524371868863,299.880519875667,301.110412441046,302.198938186584,303.130948122917,304.433474142569,305.602712863954,306.623242954845,307.482275634406,308.170736932199,308.672037137782,308.969339838543,309.679619997463,310.191321383989,310.489157802410,310.560020078210,310.393526894953,310.634101046058,310.645998943213,310.417233496500,309.939256133531,309.848376476260,309.508879481101,308.923473571543,308.089197201795,307.613528662533,306.885596976234,305.914043221592,304.706259308154,303.809336693204,302.672350443582,301.308667452257,300.226718942016,298.910905908619,297.882847133648,296.618204276468,295.135254369179,293.905563640951,292.453624698857,291.260715248805,289.841415733154,288.220155937988,286.815698583131,285.207319836128,283.819560081566,282.225348712561,280.855039061270,279.275430711438,277.922743306442,276.357999807139,275.023075227932,273.473501464035,271.743649239258,270.199024992125,268.474141939560,266.936905357181,265.218606670095,263.692380317779,261.984419286955,260.473287307954,258.778616550571,257.285775397739,255.606911318360,254.134955805179,252.473976217183,251.026233475579,249.385707186261,247.964820876965,246.347628171272,244.957226953565,243.367538983143,242.012855380698,240.456160661003,239.143479650165,237.624307299906,236.359153715713,234.883916672487,233.674841943378,232.247545950067,231.095294630029,229.716107926390,228.619450990510,227.287926889745,226.246245048550,225.530238445689,224.562199803540,223.942370238705,223.065347490807,222.544874504044,221.762519785820,221.343089109310,220.658209943667,220.340778059843,220.402007750965,220.203785610934,220.393538645656,220.331482791823,220.662523432815,220.748628730163,221.228190933773,221.470443151748,222.104000281382,222.512985538860,223.309585046913,223.897744420684,224.867180944329,225.650321322669,226.806311176669,227.799157661785,229.146356451949,230.359955779161,231.421454005206,232.829333073093,234.113511590048,235.258243714145,236.742277177779,238.114856780289,239.362674665237,240.936157858590,242.416772384055,243.790471752801,245.464323459407,247.061872400190,248.571369516902,249.980672203265,251.685229075133,253.319963790249,254.872403481234,256.331928231843,258.075662103897,259.758229015254,261.369436491407,262.898308978546,264.692285745092,266.433161172041,268.112054434931,269.719484676738,271.245473125132,273.039000952238,274.781766557637,276.464863164736,278.078375938455,279.611495838238,281.408974045858,283.156156180772,284.844606681597,286.465068730150,288.007574845078,289.461525814030,291.203737802790,292.888118548964,294.504907834979,296.043159660707,297.490846142032,298.834953174481,300.490666192711,302.073407128329,303.572076795465,304.974595506372,306.268053337108,307.438841033747,308.472830571577,309.873624411130,311.166920156454,312.337560881816,313.369284075979,314.245041517548,314.947425764512,316.044399354065,316.992022154589,317.772061538735,318.365905286377,318.755129907839,318.922309795187,319.495465801582,319.859719766680,319.995147283359,319.884496879428,319.514974470229,319.524721297969,319.277447704826,318.761250572546,317.971770412716,317.518533759450,316.787983723386,315.781379861247,315.080605080931,314.100489459595,312.851788325616,311.869644940524,310.617470782008,309.629162376249,308.370855067541,307.374621106426,306.108308377891,304.595525739493,303.296093774485,301.753416753800,300.416652232091,298.840702309078,297.462122406101,295.849430127899,294.424502940002,292.771988759711,291.296591241276,289.601783037468,288.072429251083,286.747622885345,285.179462221513,283.807314161255,282.198648355460,280.777118830123,279.127357061128,277.655658636357,275.963951654053,274.439160628731,272.704619387522,271.125271682736,269.741104823212,268.123872040406,266.694210154567,265.038552463133,263.561026382605,261.866231189980,260.339842375695,258.606434619510,257.030254385132,255.652848696791,254.042650125988,252.623862203590,250.979647253461,249.517879651549,248.280353342016,246.792486207308,245.524000179108,244.009532261754,242.709996072156,241.169917998424,239.838903216394,238.759748282230,237.417958123930,236.327369135966,234.976986920991,233.876288663758,233.067046088019,231.983229284115,231.194695877808,230.133147387836,229.372385959038,228.950948412426,228.257007114544,227.910948900493,227.296156193453,227.039939858905,227.170053751949,227.055789929349,227.336428263108,227.384141983024,227.833738220632,228.065273011763,228.702853898170,229.141126396075,229.984710663007,230.651834964246,231.716065068237,232.630723483056,233.377954732653,234.519781429715,235.522958383615,236.895916244385,238.160654192932,239.302286720241,240.795347100251,242.197037927769,243.494086502251,245.115480393208,246.664627187136,248.130435415459,249.500916430145,251.181360522598,252.798809310376,254.343442666072,255.804456568079,257.553951019046,259.251374726259,260.888398546622,262.455761492624,263.943374312944,265.713217767222,267.434661038262,269.099636110253,270.699468431178,272.224676653834,274.021617407339,275.774874811357,277.477023217815,279.119961481205,280.694754780721,282.191671227951,283.968842010381,285.699231542372,287.375009430159,288.987784105591,290.528341125937,291.986539051004,293.735630479126,295.433866823844,297.073022220479,298.643797995888,300.136303367267,301.539816035935,303.247596903541,304.898627824788,306.483881674346,307.993160924009,309.415012250277,310.737637001638,311.948299005699,313.502262547651,314.976869854647,316.360270169229,317.639108050823,318.798622005019,319.822722114522,320.695693802559,321.954173167453,323.091400067782,324.090273907795,324.932191986755,325.597337537011,326.067101912380,326.940446992091,327.640326912618,328.144460961718,328.430355182593,328.476741943439,328.266694160971,328.439264597117,328.361438707187,328.014851101023,327.388925172348,327.107027024654,326.545057869841,325.697286398127,325.164935820042,324.344300406407,323.238517726484,322.409942656612,321.295116966636,320.454057621663,319.324839340708,317.925008106099,316.747966579322,315.304631429600,314.075351227902,312.584974964135,311.298806419955,309.758082589641,308.411051387500,306.817953217514,305.407526867279,303.760954658620,302.284678213377,300.584418983559,299.040892760050,297.693154099269,296.100473185584,294.691962814360,293.047527377146,291.574415616871,289.876564984431,288.337113748425,286.586373093497,284.980109468079,283.557372127612,281.902599710811,280.419382420685,278.715203925985,277.169950439390,275.416868870520,273.810448602505,272.390575691052,270.741252742178,269.268739992756,267.576144736714,266.050074638267,264.732089719302,263.171817651215,261.811925064494,260.216120417464,258.812759842674,257.180805986990,255.734430785679,254.516229754069,253.048041406360,251.804495776872,250.314013174740,249.044452797953,248.039239848314,246.769844298058,245.765942253485,244.498396664877,243.498426924427,242.236882860241,241.246025113809,240.569281415887,239.623305978894,238.999297823193,238.107665313923,237.547325298838,236.722807653215,236.241848600215,236.140301704797,235.791622484254,235.834001227997,235.638358048594,235.845213374552,235.826942898642,236.220978809486,236.406614887545,237.010771070636,237.427345337472,238.261075574312,238.930698066925,240.006337350988,240.944900318258,241.730257414358,242.915488438988,243.977394380079,244.901329960540,246.213368662887,247.418671300745,248.504164743911,249.958310188531,251.324855507565
};

int main(int argc, char** argv)
{
	//initialize ros 
	ros::init(argc, argv, "gnc_node");
	ros::NodeHandle gnc_node("~");
	
	//initialize control publisher/subscribers
	init_publisher_subscriber(gnc_node);

  	// wait for FCU connection
	wait4connect();

	//wait for used to switch to mode GUIDED
	set_mode("GUIDED");

	//create local reference frame 
	initialize_local_frame();

	//request takeoff
	takeoff(3);

	std::vector<gnc_api_waypoint> waypointList;
	gnc_api_waypoint nextWayPoint;


	for (int i = 0; i < 500; i++) {
		nextWayPoint.x = ((xList[i] - xList[0]) / 20);
		nextWayPoint.y = ((yList[i] - yList[0]) / 20);
		nextWayPoint.z = 3;
		nextWayPoint.psi = 0;
		waypointList.push_back(nextWayPoint);


	}

	ros::Rate rate(2.0);
	int counter = 0;
	while(ros::ok())
	{
		ros::spinOnce();
		rate.sleep();
		if(check_waypoint_reached(1) == 1)
		{
			if (counter < waypointList.size())
			{
				set_destination(waypointList[counter].x,waypointList[counter].y,waypointList[counter].z, waypointList[counter].psi);
				counter++;	
			}else{
				//land after all waypoints are reached
				land();
			}	
		}	
		
	}
	
	return 0;

}