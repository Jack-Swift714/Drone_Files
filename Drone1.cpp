#include <gnc_functions.hpp>
#include <math.h>
//include API 

double xList [500] = {
101.997596008318,103.987951356574,105.966428640784,107.928711607039,109.870902643561,111.789594183943,113.681911934396,115.545531087183,117.378668864011,119.180058069628,120.948906849319,122.684849686893,124.387894067314,126.058366376288,127.696859694507,129.304185288582,130.881328872889,132.429412143023,133.949659660384,135.443370880328,136.911896938128,138.356621711700,139.778946644241,141.180278814222,142.562021769551,143.925568686158,145.272297460977,146.603567400175,147.920717212290,149.225064060893,150.517903471462,151.800509922294,153.074137979321,154.340023860210,155.599387334376,156.853433883040,158.103357057688,159.350340986606,160.595562987930,161.840196254186,163.085412577794,164.332385089635,165.582290983661,166.836314199651,168.095648033578,169.361497640562,170.635082388870,171.917638014645,173.210418515786,174.514697709205,175.831770358265,177.162952756023,178.509582624574,179.873018160881,181.254636024652,182.655828024067,184.077996210627,185.522546046202,186.990877255078,188.484371924955,190.004379378199,191.552197306206,193.129048656031,194.736053794527,196.374197569866,198.044291066450,199.746928132199,201.482437171446,203.250829259987,205.051744353321,206.884398199319,208.747533466720,210.639379443668,212.557625275836,214.499411891720,216.461347291519,218.439548600657,220.429712184100,222.427210348399,224.427210098372,226.424806595672,228.415161953609,230.393639237959,232.355922204216,234.298113240738,236.216804781119,238.109122531573,239.972741684359,241.805879461188,243.607268666805,245.376117446495,247.112060284070,248.815104664491,250.485576973465,252.124070291684,253.731395885758,255.308539470066,256.856622740200,258.376870257561,259.870581477505,261.339107535305,262.783832308876,264.206157241417,265.607489411399,266.989232366728,268.352779283334,269.699508058154,271.030777997351,272.347927809467,273.652274658070,274.945114068639,276.227720519471,277.501348576498,278.767234457387,280.026597931553,281.280644480217,282.530567654865,283.777551583783,285.022773585107,286.267406851363,287.512623174971,288.759595686812,290.009501580838,291.263524796828,292.522858630755,293.788708237739,295.062292986047,296.344848611822,297.637629112963,298.941908306382,300.258980955442,301.590163353200,302.936793221752,304.300228758058,305.681846621829,307.083038621244,308.505206807805,309.949756643379,311.418087852256,312.911582522132,314.431589975376,315.979407903384,317.556259253208,319.163264391704,320.801408167043,322.471501663627,324.174138729376,325.909647768623,327.678039857164,329.478954950498,331.311608796496,333.174744063897,335.066590040845,336.984835873013,338.926622488897,340.888557888696,342.866759197834,344.856922781277,346.854420945577,348.854420695550,350.852017192849,352.842372550786,354.820849835136,356.783132801393,358.725323837915,360.644015378296,362.536333128750,364.399952281536,366.233090058365,368.034479263982,369.803328043672,371.539270881247,373.242315261668,374.912787570642,376.551280888861,378.158606482935,379.735750067243,381.283833337377,382.804080854738,384.297792074682,385.766318132482,387.211042906053,388.633367838594,390.034700008576,391.416442963905,392.779989880511,394.126718655331,395.457988594528,396.775138406644,398.079485255247,399.372324665816,400.654931116648,401.928559173675,403.194445054564,404.453808528730,405.707855077394,406.957778252042,408.204762180960,409.449984182284,410.694617448540,411.939833772148,413.186806283989,414.436712178015,415.690735394005,416.950069227932,418.215918834916,419.489503583224,420.772059208999,422.064839710140,423.369118903559,424.686191552619,426.017373950377,427.364003818929,428.727439355235,430.109057219006,431.510249218421,432.932417404982,434.376967240556,435.845298449433,437.338793119309,438.858800572553,440.406618500561,441.983469850385,443.590474988881,445.228618764220,446.898712260804,448.601349326553,450.336858365800,452.105250454341,453.906165547675,455.738819393673,457.601954661074,459.493800638022,461.412046470190,463.353833086074,465.315768485873,467.293969795011,469.284133378454,471.281631542754,473.281631292727,475.279227790026,477.269583147963,479.248060432313,481.210343398570,483.152534435092,485.071225975473,486.963543725927,488.827162878713,490.660300655542,492.461689861159,494.230538640849,495.966481478424,497.669525858845,499.339998167819,500.978491486038,502.585817080112,504.162960664420,505.711043934554,507.231291451915,508.725002671859,510.193528729659,511.638253503230,513.060578435772,514.461910605753,515.843653561082,517.207200477689,518.553929252508,519.885199191705,521.202349003821,522.506695852424,523.799535262993,525.082141713825,526.355769770852,527.621655651741,528.881019125907,530.135065674571,531.384988849219,532.631972778137,533.877194779461,535.121828045717,536.367044369325,537.614016881166,538.863922775192,540.117945991182,541.377279825108,542.643129432093,543.916714180400,545.199269806176,546.492050307317,547.796329500736,549.113402149796,550.444584547554,551.791214416105,553.154649952411,554.536267816183,555.937459815597,557.359628002158,558.804177837732,560.272509046609,561.766003716485,563.286011169730,564.833829097737,566.410680447562,568.017685586058,569.655829361396,571.325922857981,573.028559923730,574.764068962977,576.532461051518,578.333376144852,580.166029990850,582.029165258251,583.921011235199,585.839257067367,587.781043683251,589.742979083050,591.721180392188,593.711343975631,595.708842139930,597.708841889903,599.706438387203,601.696793745140,603.675271029490,605.637553995747,607.579745032269,609.498436572650,611.390754323104,613.254373475890,615.087511252719,616.888900458336,618.657749238026,620.393692075601,622.096736456022,623.767208764996,625.405702083215,627.013027677289,628.590171261596,630.138254531731,631.658502049092,633.152213269036,634.620739326836,636.065464100407,637.487789032949,638.889121202930,640.270864158259,641.634411074866,642.981139849685,644.312409788882,645.629559600998,646.933906449601,648.226745860170,649.509352311002,650.782980368029,652.048866248918,653.308229723084,654.562276271748,655.812199446396,657.059183375314,658.304405376638,659.549038642894,660.794254966502,662.041227478343,663.291133372369,664.545156588359,665.804490422285,667.070340029270,668.343924777577,669.626480403353,670.919260904494,672.223540097913,673.540612746973,674.871795144731,676.218425013282,677.581860549588,678.963478413360,680.364670412774,681.786838599335,683.231388434909,684.699719643786,686.193214313662,687.713221766907,689.261039694914,690.837891044739,692.444896183235,694.083039958573,695.753133455158,697.455770520907,699.191279560154,700.959671648695,702.760586742029,704.593240588027,706.456375855428,708.348221832376,710.266467664544,712.208254280428,714.170189680227,716.148390989365,718.138554572808,720.136052737107,722.136052487080,724.133648984380,726.124004342317,728.102481626667,730.064764592924,732.006955629446,733.925647169827,735.817964920281,737.681584073067,739.514721849896,741.316111055513,743.084959835203,744.820902672778,746.523947053199,748.194419362173,749.832912680392,751.440238274466,753.017381858773,754.565465128908,756.085712646269,757.579423866213,759.047949924013,760.492674697584,761.914999630126,763.316331800107,764.698074755436,766.061621672043,767.408350446862,768.739620386059,770.056770198175,771.361117046778,772.653956457347,773.936562908179,775.210190965206,776.476076846095,777.735440320261,778.989486868925,780.239410043573,781.486393972491,782.731615973815,783.976249240071,785.221465563679,786.468438075520,787.718343969546,788.972367185536,790.231701019462,791.497550626447,792.771135374754,794.053691000530,795.346471501671,796.650750695090,797.967823344150,799.299005741908,800.645635610459,802.009071146765,803.390689010537,804.791881009951,806.214049196512,807.658599032086,809.126930240963,810.620424910839,812.140432364084,813.688250292091,815.265101641916,816.872106780412,818.510250555750,820.180344052335,821.882981118084,823.618490157331,825.386882245872,827.187797339206,829.020451185204,830.883586452605,832.775432429553,834.693678261721,836.635464877605,838.597400277404,840.575601586542,842.565765169985,844.563263334284,846.563263084257,848.560859581557,850.551214939494,852.529692223844,854.491975190101,856.434166226623,858.352857767004,860.245175517458,862.108794670244,863.941932447073,865.743321652690,867.512170432380,869.248113269955,870.951157650376,872.621629959350,874.260123277569,875.867448871643,877.444592455950,878.992675726085,880.512923243446,0
};
double yList [500] = {
250.098031564060,250.294209003300,250.586831004981,250.973412898432,251.450795321289,252.015262125335,252.662667354938,253.388562425432,254.188316069478,255.057221662674,255.990588682976,256.983816987382,258.032454121150,259.132236947416,260.279119524733,261.469289443119,262.699174850171,263.965444248337,265.265000898105,266.594973375795,267.952703546913,269.335732949575,270.741788349007,272.168767027676,273.614722215571,275.077848938111,276.556470460703,278.049025434227,279.554055790214,281.070195394123,282.596159436451,284.130734521706,285.672769402101,287.221166294556,288.774872714681,290.332873758898,291.894184764905,293.457844280599,295.022907272117,296.588438502252,298.153506011154,299.717174631647,301.278499471671,302.836519296243,304.390249740924,305.938676288261,307.480746938030,309.015364501721,310.541378451812,312.057576257381,313.562674140277,315.055307190930,316.534018791319,317.997249305741,319.443324019754,320.870440336239,322.276654277691,323.659866399002,325.017807289114,326.348022937441,327.647860366537,328.914454090562,330.144714152726,331.335316724892,332.482698514585,333.583056507544,334.632354855172,335.626340959046,336.560572954422,337.430460778571,338.231322739677,338.958458886055,339.607241437844,340.173221055293,340.652245833747,341.040587805487,341.335069690376,341.533183069877,341.633188487823,341.634188541878,341.536166942344,341.339989601314,341.047367600584,340.660785707142,340.183403284285,339.618936480239,338.971531250636,338.245636180142,337.445882536096,336.576976942900,335.643609922598,334.650381618193,333.601744484424,332.501961658158,331.355079080841,330.164909162455,328.935023755403,327.668754357237,326.369197707469,325.039225229779,323.681495058662,322.298465655999,320.892410256567,319.465431577898,318.019476390003,316.556349667463,315.077728144871,313.585173171347,312.080142815360,310.564003211451,309.038039169123,307.503464083868,305.961429203473,304.413032311018,302.859325890894,301.301324846676,299.740013840669,298.176354324975,296.611291333457,295.045760103322,293.480692594420,291.917023973927,290.355699133903,288.797679309331,287.243948864650,285.695522317313,284.153451667545,282.618834103853,281.092820153763,279.576622348193,278.071524465297,276.578891414645,275.100179814256,273.636949299833,272.190874585820,270.763758269335,269.357544327883,267.974332206572,266.616391316460,265.286175668134,263.986338239037,262.719744515012,261.489484452848,260.298881880682,259.151500090989,258.051142098031,257.001843750402,256.007857646529,255.073625651153,254.203737827003,253.402875865897,252.675739719519,252.026957167730,251.460977550281,250.981952771827,250.593610800087,250.299128915198,250.101015535697,250.001010117751,250.000010063696,250.098031663230,250.294209004260,250.586831004990,250.973412898433,251.450795321289,252.015262125335,252.662667354938,253.388562425432,254.188316069478,255.057221662674,255.990588682976,256.983816987382,258.032454121150,259.132236947416,260.279119524733,261.469289443119,262.699174850171,263.965444248337,265.265000898105,266.594973375795,267.952703546913,269.335732949575,270.741788349007,272.168767027676,273.614722215571,275.077848938111,276.556470460703,278.049025434227,279.554055790214,281.070195394123,282.596159436451,284.130734521706,285.672769402101,287.221166294556,288.774872714681,290.332873758898,291.894184764905,293.457844280599,295.022907272117,296.588438502252,298.153506011154,299.717174631647,301.278499471671,302.836519296243,304.390249740924,305.938676288261,307.480746938030,309.015364501721,310.541378451812,312.057576257381,313.562674140277,315.055307190930,316.534018791319,317.997249305741,319.443324019754,320.870440336239,322.276654277691,323.659866399002,325.017807289114,326.348022937441,327.647860366537,328.914454090562,330.144714152726,331.335316724892,332.482698514585,333.583056507544,334.632354855172,335.626340959046,336.560572954422,337.430460778571,338.231322739677,338.958458886055,339.607241437844,340.173221055293,340.652245833747,341.040587805487,341.335069690376,341.533183069877,341.633188487823,341.634188541878,341.536166942344,341.339989601314,341.047367600584,340.660785707142,340.183403284285,339.618936480239,338.971531250636,338.245636180142,337.445882536096,336.576976942900,335.643609922598,334.650381618193,333.601744484424,332.501961658158,331.355079080841,330.164909162455,328.935023755403,327.668754357237,326.369197707469,325.039225229779,323.681495058662,322.298465655999,320.892410256567,319.465431577898,318.019476390003,316.556349667463,315.077728144871,313.585173171347,312.080142815360,310.564003211451,309.038039169123,307.503464083868,305.961429203473,304.413032311018,302.859325890894,301.301324846676,299.740013840669,298.176354324975,296.611291333457,295.045760103322,293.480692594420,291.917023973927,290.355699133903,288.797679309331,287.243948864650,285.695522317313,284.153451667545,282.618834103853,281.092820153763,279.576622348193,278.071524465297,276.578891414645,275.100179814256,273.636949299833,272.190874585820,270.763758269335,269.357544327883,267.974332206572,266.616391316460,265.286175668134,263.986338239037,262.719744515012,261.489484452848,260.298881880682,259.151500090989,258.051142098031,257.001843750402,256.007857646529,255.073625651153,254.203737827003,253.402875865897,252.675739719519,252.026957167730,251.460977550281,250.981952771827,250.593610800087,250.299128915198,250.101015535697,250.001010117751,250.000010063696,250.098031663230,250.294209004260,250.586831004990,250.973412898433,251.450795321289,252.015262125335,252.662667354938,253.388562425432,254.188316069478,255.057221662674,255.990588682976,256.983816987382,258.032454121150,259.132236947416,260.279119524733,261.469289443119,262.699174850171,263.965444248337,265.265000898105,266.594973375795,267.952703546913,269.335732949575,270.741788349007,272.168767027676,273.614722215571,275.077848938111,276.556470460703,278.049025434227,279.554055790214,281.070195394123,282.596159436451,284.130734521706,285.672769402101,287.221166294556,288.774872714681,290.332873758898,291.894184764905,293.457844280599,295.022907272117,296.588438502252,298.153506011154,299.717174631647,301.278499471671,302.836519296243,304.390249740924,305.938676288261,307.480746938029,309.015364501721,310.541378451812,312.057576257381,313.562674140277,315.055307190929,316.534018791319,317.997249305741,319.443324019754,320.870440336239,322.276654277691,323.659866399002,325.017807289114,326.348022937441,327.647860366537,328.914454090562,330.144714152726,331.335316724892,332.482698514585,333.583056507543,334.632354855172,335.626340959046,336.560572954422,337.430460778571,338.231322739677,338.958458886055,339.607241437844,340.173221055293,340.652245833747,341.040587805487,341.335069690376,341.533183069877,341.633188487823,341.634188541878,341.536166942344,341.339989601314,341.047367600584,340.660785707141,340.183403284285,339.618936480239,338.971531250636,338.245636180142,337.445882536096,336.576976942900,335.643609922598,334.650381618192,333.601744484424,332.501961658158,331.355079080841,330.164909162455,328.935023755403,327.668754357237,326.369197707469,325.039225229779,323.681495058661,322.298465655999,320.892410256567,319.465431577898,318.019476390003,316.556349667463,315.077728144871,313.585173171347,312.080142815360,310.564003211451,309.038039169123,307.503464083868,305.961429203473,304.413032311018,302.859325890893,301.301324846676,299.740013840669,298.176354324975,296.611291333457,295.045760103322,293.480692594420,291.917023973927,290.355699133903,288.797679309331,287.243948864650,285.695522317313,284.153451667545,282.618834103853,281.092820153762,279.576622348193,278.071524465297,276.578891414645,275.100179814255,273.636949299833,272.190874585820,270.763758269335,269.357544327883,267.974332206572,266.616391316460,265.286175668134,263.986338239037,262.719744515012,261.489484452848,260.298881880682,259.151500090989,258.051142098031,257.001843750402,256.007857646529,255.073625651152,254.203737827003,253.402875865897,252.675739719519,252.026957167730,251.460977550281,250.981952771827,250.593610800087,250.299128915198,250.101015535697,250.001010117751,250.000010063696,250.098031663230,250.294209004260,250.586831004990,250.973412898432,251.450795321289,252.015262125335,252.662667354938,253.388562425432,254.188316069478,255.057221662674,255.990588682976,256.983816987382,258.032454121150,259.132236947416,260.279119524733,261.469289443119,262.699174850171,263.965444248337,265.265000898105,0
};

int main(int argc, char** argv)
{
	//initialize ros 
	ros::init(argc, argv, "gnc_node");
	ros::NodeHandle gnc_node("~");
	
	//initialize control publisher/subscribers
	init_publisher_subscriber(gnc_node);

  	// wait for FCU connection
	wait4connect();

	//wait for used to switch to mode GUIDED
	set_mode("GUIDED");

	//create local reference frame 
	initialize_local_frame();

	//request takeoff
	takeoff(3);

	std::vector<gnc_api_waypoint> waypointList;
	gnc_api_waypoint nextWayPoint;


	for (int i = 0; i < 500; i++) {
		nextWayPoint.x = ((xList[i] - xList[0]) / 20);
		nextWayPoint.y = ((yList[i] - yList[0]) / 20);
		nextWayPoint.z = 3;
		nextWayPoint.psi = 0;
		waypointList.push_back(nextWayPoint);


	}

	ros::Rate rate(2.0);
	int counter = 0;
	while(ros::ok())
	{
		ros::spinOnce();
		rate.sleep();
		if(check_waypoint_reached(1) == 1)
		{
			if (counter < waypointList.size())
			{
				set_destination(waypointList[counter].x,waypointList[counter].y,waypointList[counter].z, waypointList[counter].psi);
				counter++;

			}else{
				//land after all waypoints are reached
				land();
			}	
		}	
		
	}
	
	return 0;

}