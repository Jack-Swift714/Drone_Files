#include <gnc_functions.hpp>
#include <math.h>
//include API 


double xList [499] = {
42.1970828273893,43.6112963897624,45.0255099521355,46.4397235145086,47.8539370768817,49.2681506392547,50.6823642016278,52.0965777640009,53.5107913263740,54.9250048887471,56.3392184511202,57.7534320134933,59.1676455758664,60.5818591382395,61.9960727006126,63.4102862629857,64.8244998253588,66.2387133877319,67.6529269501049,69.0671405124780,70.4813540748511,71.8955676372242,73.3097811995973,74.7239947619704,76.1382083243435,77.5524218867166,78.9666354490897,80.3808490114628,81.7950625738359,83.2092761362090,84.6234896985821,86.0377032609551,87.4519168233282,88.8661303857013,90.2803439480744,91.6945575104475,93.1087710728206,94.5229846351937,95.9371981975668,97.3514117599399,98.7656253223130,100.179838884686,101.594052447059,103.008266009432,104.422479571805,105.836693134178,107.250906696552,108.665120258925,110.079333821298,111.493547383671,112.907760946044,114.321974508417,115.736188070790,117.150401633163,118.564615195536,119.978828757909,121.393042320282,122.807255882656,124.221469445029,125.635683007402,127.049896569775,128.464110132148,129.878323694521,131.292537256894,132.706750819267,134.120964381640,135.535177944013,136.949391506387,138.363605068760,139.777818631133,141.192032193506,142.606245755879,144.020459318252,145.434672880625,146.848886442998,148.263100005371,149.677313567745,151.091527130118,152.505740692491,153.919954254864,155.334167817237,156.748381379610,158.162594941983,159.576808504356,160.991022066729,162.405235629102,163.819449191476,165.233662753849,166.647876316222,168.062089878595,169.476303440968,170.890517003341,172.304730565714,173.718944128087,175.133157690460,176.547371252834,177.961584815207,179.375798377580,180.790011939953,182.204225502326,183.618439064699,185.032652627072,186.446866189445,187.861079751818,189.275293314192,190.689506876565,192.103720438938,193.517934001311,194.932147563684,196.346361126057,197.760574688430,199.174788250803,200.589001813176,202.003215375549,203.417428937923,204.831642500296,206.245856062669,207.660069625042,209.074283187415,210.488496749788,211.902710312161,213.316923874534,214.731137436907,216.145350999281,217.559564561654,218.973778124027,220.387991686400,221.802205248773,223.216418811146,224.630632373519,226.044845935892,227.459059498265,228.873273060638,230.287486623012,231.701700185385,233.115913747758,234.530127310131,235.944340872504,237.358554434877,238.772767997250,240.186981559623,241.601195121996,243.015408684370,244.429622246743,245.843835809116,247.258049371489,248.672262933862,250.086476496235,251.500690058608,252.914903620981,254.329117183354,255.743330745728,257.157544308101,258.571757870474,259.985971432847,261.400184995220,262.814398557593,264.228612119966,265.642825682339,267.057039244712,268.471252807085,269.885466369459,271.299679931832,272.713893494205,274.128107056578,275.542320618951,276.956534181324,278.370747743697,279.784961306070,281.199174868443,282.613388430817,284.027601993190,285.441815555563,286.856029117936,288.270242680309,289.684456242682,291.098669805055,292.512883367428,293.927096929801,295.341310492174,296.755524054548,298.169737616921,299.583951179294,300.998164741667,302.412378304040,303.826591866413,305.240805428786,306.655018991159,308.069232553532,309.483446115906,310.897659678279,312.311873240652,313.726086803025,315.140300365398,316.554513927771,317.968727490144,319.382941052517,320.797154614890,322.211368177263,323.625581739637,325.039795302010,326.454008864383,327.868222426756,329.282435989129,330.696649551502,332.110863113875,333.525076676248,334.939290238621,336.353503800995,337.767717363368,339.181930925741,340.596144488114,342.010358050487,343.424571612860,344.838785175233,346.252998737606,347.667212299979,349.081425862353,350.495639424726,351.909852987099,353.324066549472,354.738280111845,356.152493674218,357.566707236591,358.980920798964,360.395134361337,361.809347923710,363.223561486084,364.637775048457,366.051988610830,367.466202173203,368.880415735576,370.294629297949,371.708842860322,373.123056422695,374.537269985068,375.951483547442,377.365697109815,378.779910672188,380.194124234561,381.608337796934,383.022551359307,384.436764921680,385.850978484053,387.265192046426,388.679405608799,390.093619171173,391.507832733546,392.922046295919,394.336259858292,395.750473420665,397.164686983038,398.578900545411,399.993114107784,401.407327670157,402.821541232531,404.235754794904,405.649968357277,407.064181919650,408.478395482023,409.892609044396,411.306822606769,412.721036169142,414.135249731515,415.549463293889,416.963676856262,418.377890418635,419.792103981008,421.206317543381,422.620531105754,424.034744668127,425.448958230500,426.863171792873,428.277385355246,429.691598917620,431.105812479993,432.520026042366,433.934239604739,435.348453167112,436.762666729485,438.176880291858,439.591093854231,441.005307416604,442.419520978978,443.833734541351,445.247948103724,446.662161666097,448.076375228470,449.490588790843,450.904802353216,452.319015915589,453.733229477962,455.147443040336,456.561656602709,457.975870165082,459.390083727455,460.804297289828,462.218510852201,463.632724414574,465.046937976947,466.461151539320,467.875365101693,469.289578664067,470.703792226440,472.118005788813,473.532219351186,474.946432913559,476.360646475932,477.774860038305,479.189073600678,480.603287163051,482.017500725425,483.431714287798,484.845927850171,486.260141412544,487.674354974917,489.088568537290,490.502782099663,491.916995662036,493.331209224409,494.745422786782,496.159636349156,497.573849911529,498.988063473902,500.402277036275,501.816490598648,503.230704161021,504.644917723394,506.059131285767,507.473344848140,508.887558410514,510.301771972887,511.715985535260,513.130199097633,514.544412660006,515.958626222379,517.372839784752,518.787053347125,520.201266909498,521.615480471872,523.029694034245,524.443907596618,525.858121158991,527.272334721364,528.686548283737,530.100761846110,531.514975408483,532.929188970856,534.343402533229,535.757616095603,537.171829657976,538.586043220349,540.000256782722,541.414470345095,542.828683907468,544.242897469841,545.657111032214,547.071324594587,548.485538156961,549.899751719334,551.313965281707,552.728178844080,554.142392406453,555.556605968826,556.970819531199,558.385033093572,559.799246655945,561.213460218319,562.627673780692,564.041887343065,565.456100905438,566.870314467811,568.284528030184,569.698741592557,571.112955154930,572.527168717303,573.941382279676,575.355595842050,576.769809404423,578.184022966796,579.598236529169,581.012450091542,582.426663653915,583.840877216288,585.255090778661,586.669304341034,588.083517903408,589.497731465781,590.911945028154,592.326158590527,593.740372152900,595.154585715273,596.568799277646,597.983012840019,599.397226402392,600.811439964765,602.225653527139,603.639867089512,605.054080651885,606.468294214258,607.882507776631,609.296721339004,610.710934901377,612.125148463750,613.539362026123,614.953575588497,616.367789150870,617.782002713243,619.196216275616,620.610429837989,622.024643400362,623.438856962735,624.853070525108,626.267284087481,627.681497649855,629.095711212228,630.509924774601,631.924138336974,633.338351899347,634.752565461720,636.166779024093,637.580992586466,638.995206148839,640.409419711212,641.823633273586,643.237846835959,644.652060398332,646.066273960705,647.480487523078,648.894701085451,650.308914647824,651.723128210197,653.137341772570,654.551555334944,655.965768897317,657.379982459690,658.794196022063,660.208409584436,661.622623146809,663.036836709182,664.451050271555,665.865263833928,667.279477396301,668.693690958675,670.107904521048,671.522118083421,672.936331645794,674.350545208167,675.764758770540,677.178972332913,678.593185895286,680.007399457659,681.421613020033,682.835826582406,684.250040144779,685.664253707152,687.078467269525,688.492680831898,689.906894394271,691.321107956644,692.735321519017,694.149535081391,695.563748643764,696.977962206137,698.392175768510,699.806389330883,701.220602893256,702.634816455629,704.049030018002,705.463243580375,706.877457142748,708.291670705122,709.705884267495,711.120097829868,712.534311392241,713.948524954614,715.362738516987,716.776952079360,718.191165641733,719.605379204106,721.019592766480,722.433806328853,723.848019891226,725.262233453599,726.676447015972,728.090660578345,729.504874140718,730.919087703091,732.333301265464,733.747514827837,735.161728390211,736.575941952584,737.990155514957,739.404369077330,740.818582639703,742.232796202076,743.647009764449,745.061223326822,746.475436889195
};
double yList [499] = {
272.616690413587,271.202476851214,269.788263288841,268.374049726468,266.959836164095,265.545622601721,264.131409039348,262.717195476975,261.302981914602,259.888768352229,258.474554789856,257.060341227483,255.646127665110,254.231914102737,252.817700540364,251.403486977990,249.989273415617,248.575059853244,247.160846290871,245.746632728498,244.332419166125,242.918205603752,241.503992041379,240.089778479006,238.675564916632,237.261351354259,235.847137791886,234.432924229513,233.018710667140,231.604497104767,230.190283542394,228.776069980021,227.361856417648,225.947642855274,224.533429292901,223.119215730528,221.705002168155,220.290788605782,218.876575043409,217.462361481036,216.048147918663,214.633934356290,213.219720793917,211.805507231543,210.391293669170,208.977080106797,207.562866544424,206.148652982051,204.734439419678,203.320225857305,201.906012294932,200.491798732559,199.077585170185,197.663371607812,196.249158045439,194.834944483066,193.420730920693,192.006517358320,190.592303795947,189.178090233574,187.763876671201,186.349663108827,184.935449546454,183.521235984081,182.107022421708,180.692808859335,179.278595296962,177.864381734589,176.450168172216,175.035954609843,173.621741047470,172.207527485096,170.793313922723,169.379100360350,167.964886797977,166.550673235604,165.136459673231,163.722246110858,162.308032548485,160.893818986112,159.479605423738,158.065391861365,156.651178298992,155.236964736619,153.822751174246,152.408537611873,150.994324049500,149.580110487127,148.165896924754,146.751683362381,145.337469800007,143.923256237634,142.509042675261,141.094829112888,139.680615550515,138.266401988142,136.852188425769,135.437974863396,134.023761301023,132.609547738649,131.195334176276,129.781120613903,128.366907051530,126.952693489157,125.538479926784,124.124266364411,122.710052802038,121.295839239665,119.881625677292,118.467412114918,117.053198552545,115.638984990172,114.224771427799,112.810557865426,111.396344303053,109.982130740680,108.567917178307,107.153703615934,105.739490053561,104.325276491188,102.911062928814,101.496849366441,100.082635804068,98.6684222416952,97.2542086793221,95.8399951169490,94.4257815545759,93.0115679922028,91.5973544298297,90.1831408674566,88.7689273050835,87.3547137427104,85.9405001803374,84.5262866179643,83.1120730555912,81.6978594932181,80.2836459308450,78.8694323684719,77.4552188060988,76.0410052437257,74.6267916813526,73.2125781189795,71.7983645566064,70.3841509942333,68.9699374318603,67.5557238694872,66.1415103071141,64.7272967447410,63.3130831823679,61.8988696199948,60.4846560576217,59.0704424952486,57.6562289328755,56.2420153705024,54.8278018081293,53.4135882457562,51.9993746833831,50.5851611210100,49.1709475586370,47.7567339962639,46.3425204338908,44.9283068715177,43.5140933091446,42.0998797467715,40.6856661843984,39.2714526220253,37.8572390596522,36.4430254972791,35.0288119349060,33.6145983725329,32.2003848101598,30.7861712477868,29.3719576854137,27.9577441230406,26.5435305606675,25.1293169982944,23.7151034359213,22.3008898735482,20.8866763111751,19.4724627488020,18.0582491864289,16.6440356240558,15.2298220616827,13.8156084993096,12.4013949369365,10.9871813745634,9.57296781219031,8.15875424981722,6.74454068744412,5.33032712507103,3.91611356269793,2.50190000032484,1.08768643795174,600,598.585786437627,597.171572875254,595.757359312881,594.343145750508,592.928932188135,591.514718625761,590.100505063388,588.686291501015,587.272077938642,585.857864376269,584.443650813896,583.029437251523,581.615223689150,580.201010126777,578.786796564403,577.372583002030,575.958369439657,574.544155877284,573.129942314911,571.715728752538,570.301515190165,568.887301627792,567.473088065419,566.058874503045,564.644660940672,563.230447378299,561.816233815926,560.402020253553,558.987806691180,557.573593128807,556.159379566434,554.745166004061,553.330952441688,551.916738879314,550.502525316941,549.088311754568,547.674098192195,546.259884629822,544.845671067449,543.431457505076,542.017243942703,540.603030380330,539.188816817956,537.774603255583,536.360389693210,534.946176130837,533.531962568464,532.117749006091,530.703535443718,529.289321881345,527.875108318972,526.460894756599,525.046681194225,523.632467631852,522.218254069479,520.804040507106,519.389826944733,517.975613382360,516.561399819987,515.147186257614,513.732972695241,512.318759132867,510.904545570494,509.490332008121,508.076118445748,506.661904883375,505.247691321002,503.833477758629,502.419264196256,501.005050633883,499.590837071509,498.176623509136,496.762409946763,495.348196384390,493.933982822017,492.519769259644,491.105555697271,489.691342134898,488.277128572525,486.862915010152,485.448701447778,484.034487885405,482.620274323032,481.206060760659,479.791847198286,478.377633635913,476.963420073540,475.549206511167,474.134992948794,472.720779386420,471.306565824047,469.892352261674,468.478138699301,467.063925136928,465.649711574555,464.235498012182,462.821284449809,461.407070887436,459.992857325062,458.578643762689,457.164430200316,455.750216637943,454.336003075570,452.921789513197,451.507575950824,450.093362388451,448.679148826078,447.264935263705,445.850721701331,444.436508138958,443.022294576585,441.608081014212,440.193867451839,438.779653889466,437.365440327093,435.951226764720,434.537013202347,433.122799639973,431.708586077600,430.294372515227,428.880158952854,427.465945390481,426.051731828108,424.637518265735,423.223304703362,421.809091140989,420.394877578616,418.980664016242,417.566450453869,416.152236891496,414.738023329123,413.323809766750,411.909596204377,410.495382642004,409.081169079631,407.666955517258,406.252741954884,404.838528392511,403.424314830138,402.010101267765,400.595887705392,399.181674143019,397.767460580646,396.353247018273,394.939033455900,393.524819893526,392.110606331153,390.696392768780,389.282179206407,387.867965644034,386.453752081661,385.039538519288,383.625324956915,382.211111394542,380.796897832169,379.382684269795,377.968470707422,376.554257145049,375.140043582676,373.725830020303,372.311616457930,370.897402895557,369.483189333184,368.068975770811,366.654762208437,365.240548646064,363.826335083691,362.412121521318,360.997907958945,359.583694396572,358.169480834199,356.755267271826,355.341053709453,353.926840147080,352.512626584706,351.098413022333,349.684199459960,348.269985897587,346.855772335214,345.441558772841,344.027345210468,342.613131648095,341.198918085722,339.784704523348,338.370490960975,336.956277398602,335.542063836229,334.127850273856,332.713636711483,331.299423149110,329.885209586737,328.470996024364,327.056782461990,325.642568899617,324.228355337244,322.814141774871,321.399928212498,319.985714650125,318.571501087752,317.157287525379,315.743073963006,314.328860400633,312.914646838259,311.500433275886,310.086219713513,308.672006151140,307.257792588767,305.843579026394,304.429365464021,303.015151901648,301.600938339275,300.186724776901,298.772511214528,297.358297652155,295.944084089782,294.529870527409,293.115656965036,291.701443402663,290.287229840290,288.873016277917,287.458802715543,286.044589153170,284.630375590797,283.216162028424,281.801948466051,280.387734903678,278.973521341305,277.559307778932,276.145094216559,274.730880654186,273.316667091812,271.902453529439,270.488239967066,269.074026404693,267.659812842320,266.245599279947,264.831385717574,263.417172155201,262.002958592828,260.588745030454,259.174531468081,257.760317905708,256.346104343335,254.931890780962,253.517677218589,252.103463656216,250.689250093843,249.275036531470,247.860822969097,246.446609406723,245.032395844350,243.618182281977,242.203968719604,240.789755157231,239.375541594858,237.961328032485,236.547114470112,235.132900907739,233.718687345365,232.304473782992,230.890260220619,229.476046658246,228.061833095873,226.647619533500,225.233405971127,223.819192408754,222.404978846381,220.990765284007,219.576551721634,218.162338159261,216.748124596888,215.333911034515,213.919697472142,212.505483909769,211.091270347396,209.677056785023,208.262843222650,206.848629660276,205.434416097903,204.020202535530,202.605988973157,201.191775410784,199.777561848411,198.363348286038,196.949134723665,195.534921161292,194.120707598918,192.706494036545,191.292280474172,189.878066911799,188.463853349426,187.049639787053,185.635426224680,184.221212662307,182.806999099934,181.392785537560,179.978571975187,178.564358412814,177.150144850441,175.735931288068,174.321717725695,172.907504163322,171.493290600949,170.079077038576,168.664863476203
};

int main(int argc, char** argv)
{
	//initialize ros 
	ros::init(argc, argv, "gnc_node");
	ros::NodeHandle gnc_node("~");
	
	//initialize control publisher/subscribers
	init_publisher_subscriber(gnc_node);

  	// wait for FCU connection
	wait4connect();

	//wait for used to switch to mode GUIDED
	set_mode("GUIDED");

	//create local reference frame 
	initialize_local_frame();

	//request takeoff
	takeoff(3);

	std::vector<gnc_api_waypoint> waypointList;
	gnc_api_waypoint nextWayPoint;


	for (int i = 0; i < 499; i++) {
		nextWayPoint.x = ((xList[i] - xList[0]) / 20);
		nextWayPoint.y = ((yList[i] - yList[0]) / 20);
		nextWayPoint.z = 3;
		nextWayPoint.psi = 0;
		waypointList.push_back(nextWayPoint);


	}

	ros::Rate rate(2.0);
	int counter = 0;
	while(ros::ok())
	{
		ros::spinOnce();
		rate.sleep();
		if(check_waypoint_reached(1) == 1)
		{
			if (counter < waypointList.size())
			{
				set_destination(waypointList[counter].x,waypointList[counter].y,waypointList[counter].z, waypointList[counter].psi);
				counter++;	
			}else{
				//land after all waypoints are reached
				land();
			}	
		}	
		
	}
	
	return 0;

}