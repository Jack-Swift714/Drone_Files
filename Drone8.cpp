#include <gnc_functions.hpp>
#include <math.h>
//include API 


double xList [499] = {
78.5211905485236,80.5164098883044,82.3927715514701,84.2691425317589,86.1456860324793,88.0225266092565,89.8997446295668,91.7773834425114,93.3896338170687,95.2687715792301,96.8820631997551,98.7611054748708,100.372964355638,102.250423922237,103.858475980791,105.732908661959,107.334857258348,108.936600002193,110.538178495320,112.139658084225,113.741122735030,115.342670226172,116.944407640519,118.546447138764,120.148901998317,121.751882906425,123.355499086250,124.564018686712,126.170372934607,127.381732689293,128.989642734274,130.202337456834,131.810732717434,133.023408603738,134.631354797570,135.842833469854,137.449517865374,138.658785008328,140.263524294313,141.469757825967,143.072008281355,144.274571418605,145.873929862420,147.072385816181,148.668608785619,149.862737866038,151.455645149135,152.645343055451,154.235039452518,155.420569765002,157.007331498224,158.189202296900,159.773521133057,160.952548748735,162.535128048374,163.712416802841,165.294203981333,166.471213598543,168.053405380007,169.231935706159,170.815983974569,171.998218526763,173.585845119802,174.774390456952,176.367610485528,177.961057995939,179.554642974505,181.148230369132,182.741620162183,184.334553837856,185.926691425293,187.517607868698,189.106802668234,190.693673654174,192.557754651656,194.422443540150,196.287486988064,198.152543991450,200.017193275466,201.880919410962,203.743126690398,205.603126104831,207.460158205018,209.313383620283,211.303092459621,213.292599284898,215.281717282140,217.270236780726,219.257919034604,221.244500961175,223.229699330945,225.203450349978,227.177581416261,229.152328538903,231.127923012724,233.104575799088,235.082470612202,237.061760184486,238.881133012971,240.700765508847,242.521049273271,244.342375430376,246.165101153643,247.989567430587,249.816073835455,251.644874057859,253.173987334833,254.702066175022,256.229325630575,257.756004058287,259.282332668273,260.808533262480,262.334841379849,263.861449872886,265.388538109416,266.916283185976,268.444830257807,269.974280035803,271.504727478061,273.036255071280,274.150199682422,275.684783070589,276.802162657231,278.339218075284,279.459390971802,280.998506861215,282.121045942540,283.661957036415,284.786710929635,286.329418716583,287.456525302613,289.001212993928,290.131080291960,291.678172055896,292.811606439746,294.361853398282,295.500068995145,297.054523855740,298.199147855455,299.759108851939,300.912140763856,302.479230413507,303.643156282268,305.219267268607,306.795333844951,308.371285979229,310.226005188871,311.795154604011,313.646565990121,315.211711439648,317.061658216603,318.626375220329,320.477111985043,322.328474256209,324.180321735317,326.032418211288,327.884435597445,329.735975293344,331.586546460845,333.435586627865,335.282466101271,337.270390534409,339.258363407776,341.246248332728,343.233875621108,345.221060830139,347.207592213089,349.193247524895,351.166233406822,353.139329487978,355.112743417792,357.086682399281,359.061351950497,361.036931505331,362.846135020696,364.655003403302,366.463871722875,368.273083970685,370.083006256800,371.893979410456,373.706334033476,375.520314750128,377.026442811624,378.531517450885,380.035680173053,381.539077436719,383.041912930884,384.544394477200,386.046732314204,387.549132598227,389.051823640980,390.555026295615,392.058932528377,393.563662035280,395.069353694986,396.150908930951,397.661064211250,398.747541939935,400.261111729837,401.351289120320,402.867397542055,403.960235822916,405.478158215570,406.572915108296,408.092150812153,409.188267611545,410.708455161513,411.805662370099,413.326756236065,414.425159553890,415.947324070173,417.047318317308,418.570984670758,419.673378379507,421.199330865059,422.305368230417,423.834662788876,424.946033380743,426.480168772052,427.599191145937,429.140023488882,430.269505989411,431.819260090061,433.656936325476,435.196900413496,436.736755398864,438.569569362759,440.103667686043,441.933832489986,443.465370743816,445.295020551279,447.125573994225,448.956973253291,450.789046399309,452.621561574184,454.454165335418,456.286397979335,458.117751890016,459.947635272425,461.929552828655,463.911161454037,465.892310919294,467.872794000517,469.852354516171,471.830724638897,473.807607021211,475.790648465005,477.774163939288,479.758301848261,481.743208351020,483.729023278696,485.570108989424,487.411632078610,489.253910975355,491.097287393730,492.942123929938,494.788772684202,496.637505920818,498.200949493384,499.764143220539,501.327304144963,502.890550639666,504.454133832702,506.018410151316,507.583643901240,509.150203230795,510.718380168932,512.288455012133,513.860630083684,515.028800884130,516.605174632398,517.777866879655,519.357069399277,520.532392653098,522.112959430683,523.289139126039,524.869551195096,526.044569877129,527.623315434353,528.795392462797,530.371245259234,531.538882737571,533.110723665254,534.272638103445,535.839603826347,536.994873936284,538.151267217135,539.714152702858,540.864311885847,542.015551984011,543.574958736937,544.721235009053,545.868468715165,547.425860478969,548.570621274496,550.126692612034,551.270495423385,552.826690386840,553.971794769270,555.529955693950,556.679042097824,558.241355490970,559.397634132910,560.966723802857,562.537859069300,564.110921643285,565.685675073990,567.261972348260,568.839087812389,570.416641088171,572.274181071581,573.852508184946,575.711902053487,577.572432640634,579.433920891391,581.296155794476,583.158807519162,585.021575116234,586.883921276456,588.875998133455,590.868414363504,592.861101310866,594.853955936621,596.846882649620,598.839766823763,600.799955498875,602.759038183795,604.717172964895,606.674529812513,608.631350046265,610.587828551086,612.544210457064,614.302576903720,616.054471275283,617.799924262813,619.539088197189,621.272054968471,622.998939212792,624.720011339686,626.435415183574,628.145320846414,629.490880992945,631.188848641757,632.516212147678,634.200285465700,635.506821087448,637.175029910256,638.457250837419,640.106198467348,641.360022223069,642.986406368655,644.207721555691,645.808640726767,646.994274898465,648.567166362451,649.714506011346,651.257215506190,652.363262480035,653.873461691604,654.937199268377,656.412854885351,657.432532494022,658.873428366851,659.850009966155,661.257094365623,662.192987509439,663.568287515890,664.467080169460,665.813312095062,666.679260723123,667.999948277054,669.303274436247,670.962383142536,672.224926843662,673.852789257659,675.072569525409,676.668988318897,677.847651565097,679.414109940921,680.555271741782,682.094330281103,683.202640350532,684.713764660490,686.206449040572,687.680111284628,689.459215027013,690.898961101267,692.656342719291,694.067340031510,695.807691641503,697.540894920026,699.267178800668,701.202897799185,702.919826242132,704.851602313536,706.783276188464,708.714879528705,710.647638298469,712.580223009016,714.511911587949,716.441844658168,718.441613762366,720.441272670478,722.440813146129,724.440287873073,726.439693433650,728.439096786641,730.345654177170,732.248654935140,734.148755403274,736.045550792458,737.939867095610,739.832147929562,741.468675480149,743.355747785315,744.982449451122,746.599281306635,748.206858291066,749.800924230263,751.381870504405,752.947524703975,754.497995099966,756.034806537952,757.558056625456,759.070602557613,760.571983299510,762.062073635310,763.543995818732,765.017040525427,766.484621103332,767.947792155547,768.974459068710,770.424492218315,771.428930637789,772.858732008749,774.278039424965,775.238005879918,776.630944175931,778.011276058086,779.380697512260,780.738651260850,781.627088723623,782.961244618660,784.281945643443,785.590091350496,786.887134733412,788.169161353531,789.437000451487,791.073060220889,792.321596272703,793.948083674522,795.184623419896,796.416024098878,797.642125182379,799.250206315519,800.464565679590,802.068664093243,803.278332412596,804.879581849340,806.088838089737,807.690219192722,808.900226015391,810.502824413340,811.715622248135,813.322595972284,814.931479512834,816.547353973635,818.169981886641,819.794190042878,821.417409798672,823.300625696305,824.925983772226,826.810580655519,828.697626186157,830.589273060293,832.485453691098,834.385507427855,836.288750095580,838.194222945014,840.193703107837,842.193565472181,844.193565141556,846.193453073633,848.192925122021,850.191661245913,852.189654211869,854.186757609523,856.069829827661,857.940966562062,859.801078192621,861.647699932664,863.481506484029,865.299825976511,867.103202718592,868.888084843320,870.654586977210,872.407725360136,874.149274040275,875.535714331928
};
double yList [499] = {
235.101855809595,235.240057785573,235.932348843584,236.624614648265,237.316412660624,238.007404302659,238.697369884570,239.386189518527,240.569679581747,241.254399430166,242.436469710286,243.121451555541,244.305474759913,244.994782801200,246.183971002026,246.881468044148,248.078865511376,249.276538330865,250.474430784449,251.672455461290,252.870500106627,254.068434008651,255.266113955665,256.463389799430,257.660109659336,258.856124796465,260.051288027076,261.644862743021,262.836343347257,264.427760182887,265.617140394278,267.207540189888,268.396264163600,269.986678321856,271.176009662458,272.767335972993,273.958371343246,275.551378868957,276.745033686740,278.340339509181,279.537333025541,281.135407460894,282.336262393098,283.937419264517,285.142438862631,286.746825268488,287.956224452982,289.563899448654,290.777516095356,292.388266814176,293.605717922838,295.219155685889,296.439784140987,298.055300739933,299.278183710767,300.894967922901,302.118875322158,303.735862755936,304.959247064592,306.575126475421,307.796106034361,309.409277278711,310.625600344789,312.234127615786,313.443114770615,314.651802088149,315.860308156023,317.068811037975,318.277574442203,319.486938864082,320.697351150317,321.909368010804,323.123641410466,324.340950111652,325.065658352826,325.788801042153,326.511028802208,327.233221556339,327.956466361104,328.682086710784,329.411596168169,330.146716687750,330.889301214167,331.641335495445,331.843965045762,332.048568545674,332.256918235014,332.470904691923,332.692533339939,332.923817254254,333.166690539448,332.843724728767,332.523090149944,332.206271902974,331.894781172761,331.590078428828,331.293544942930,331.006468665528,330.175877002332,329.345854364117,328.517260967464,327.690961367172,326.867753654779,326.048410744702,325.233625893974,324.424002681277,323.134889580661,321.844550455405,320.553241601790,319.261245867138,317.968836886073,316.676276734187,315.383843551832,314.091765183858,312.800253852954,311.509519573156,310.219735153497,308.931021307607,307.643492423858,306.357248577923,304.696186446843,303.413589930098,301.754836524870,300.475203514264,298.818335178546,297.541181202332,295.885915057298,294.610927606077,292.957165628134,291.684352725902,290.032193307527,288.761783949760,287.111511278703,285.844030677684,284.196205900134,282.932586349973,281.288060504917,280.029620960730,278.389549041795,277.137941399821,275.503769618734,274.261099095242,272.634668472058,271.403460058044,270.172194795425,268.940783056621,268.192440452336,266.952371860295,266.195882680345,264.950764323793,264.190700561707,262.945043827993,262.186905695633,261.430296324224,260.674875306434,259.920064970193,259.165060598435,258.408885516520,257.650343260601,256.888076600733,256.120589655754,255.901143880829,255.682137363222,255.462333984834,255.240212931159,255.014171021307,254.782453381591,254.543344655912,254.870952210335,255.197895408045,255.522914579195,255.844729584060,256.162030960518,256.473616297980,257.326131775841,258.179358108304,259.032584574399,259.885081520066,260.736069956077,261.584819764171,262.430615673606,263.272918445545,264.588812917899,265.905912128382,267.224052676746,268.543066197374,269.862719741862,271.182776256933,272.502996323249,273.823145324903,275.142963354038,276.462198654922,277.780631832242,279.098125327884,280.414519123787,282.096850325291,283.408121094196,285.087277473177,286.394605469931,288.071362237408,289.375745330500,291.050769059253,292.353040770486,294.026811168667,295.327550526159,297.000430665945,298.300057463499,299.972222629214,301.270788550113,302.942168265016,304.239479016289,305.909812113689,307.205358656028,308.874109119971,310.166962171108,311.833299875907,313.122197914337,314.784983350745,316.068115690426,317.725761287875,319.000843909094,320.651379967773,321.915603930336,322.704873246723,323.981004355823,325.257267112482,326.057762567655,327.340939225211,328.147473037525,329.433704189790,330.241405608663,331.047056955413,331.850783745991,332.652973242082,333.454152456649,334.255129019546,335.056954149214,335.860784264244,336.667956369054,336.936289744369,337.206895095044,337.480841798460,337.759565254570,338.044767226629,338.338112854693,338.641322429902,338.381425080566,338.125170591278,337.873780937203,337.628533765337,337.390754302351,336.609471123374,335.829219425525,335.050753969254,334.274890978655,333.502506259315,332.734464347454,331.971453587482,330.724198924070,329.476631141791,328.229022259025,326.981520596983,325.734440969031,324.488230874775,323.243223522147,321.999884522925,320.758586375543,319.519689694319,318.283459317571,316.660074895758,315.429202926068,313.809081667265,312.581841103227,310.963627505142,309.738144473192,308.120553262710,306.894870721438,305.276435953869,304.048607600415,302.428041205789,301.196502345678,299.572734283674,298.336079077864,296.708210889611,295.465384102303,293.832793837392,292.200998942190,290.953045033380,289.316850101905,287.681415530795,286.429117411765,284.790199870219,283.151952384776,281.897149255184,280.257172816017,279.000732609523,277.360087879929,276.103800796609,274.464064246629,273.210216356014,271.573267842336,270.324597805218,268.692721675668,267.452577487412,266.215025882614,264.979925021013,263.746980726860,262.516010823440,261.286089357327,260.056729498673,259.315416332706,258.087050131926,257.350399304444,256.616624179292,255.885281925425,255.155842986424,254.427469076591,253.699391553727,252.970236714543,252.792389038678,252.618384538052,252.447508179788,252.278598616399,252.110541731342,251.941981153355,252.339045830662,252.741531897061,253.148604592097,253.559401587078,253.972747172244,254.387707242823,254.803122502489,255.756090203555,256.720904232726,257.697323132748,258.684900374976,259.683312198640,260.692208034055,261.710987074882,262.739281610691,263.776693112548,265.256378177712,266.313215849063,267.809245970134,268.888086579086,270.402340411541,271.505553592891,273.040450818749,274.172251028040,275.730431373696,276.894422185939,278.478211696548,279.676985156248,281.287659428378,282.522978189882,284.161151480493,285.433962312674,287.100293639767,288.411513812498,290.105167368501,291.455145331318,293.175685239130,294.562703293687,296.308065256118,297.729372222530,299.496885736865,300.948970408039,302.735635392273,304.214709292553,306.017521810138,307.519448700799,309.036465814336,310.153317774408,311.704441045700,312.866363573709,314.451335528795,315.656095685755,317.271878143903,318.515344330340,320.157827129110,321.435050215553,323.099877170525,324.410031100357,325.741155941031,327.093309626987,328.006977987953,329.395189514223,330.349972132746,331.767394647352,332.752877409044,333.750878609103,334.760801360324,335.263784420459,336.289531329690,336.807451410352,337.325752520635,337.844316437590,338.358557176838,338.873451667543,339.391697973870,339.916443954773,339.886054320067,339.849118548712,339.806247973329,339.760413310517,339.711654677096,339.662805602916,339.058621097470,338.443325952710,337.819131903558,337.184965323259,336.543431424221,335.895918300450,334.746232440673,334.083693298378,332.920146268619,331.742922946135,330.553092605655,329.345221014179,328.120227594493,326.875749017992,325.612403637206,324.332477622126,323.036441677054,321.727929238018,320.406620845605,319.072592813232,317.729496896225,316.376670487524,315.017918395583,313.654419047595,311.938040578430,310.560577742253,308.831097050980,307.432645035501,306.023543740960,304.268988411150,302.833814936096,301.386512654225,299.928882769499,298.460563452494,296.668726720327,295.178750865577,293.676835820331,292.163972703880,290.641580355359,289.106520830355,287.559722840411,286.409371402397,284.846950931678,283.683104407550,282.111172647546,280.535211871446,278.955124489990,277.765975605604,276.176846493513,274.982330575111,273.389627665854,272.191295390847,270.598279588960,269.400123270693,267.807677513659,266.611149881345,265.020828715066,263.830183742837,262.642120717174,261.463583604084,260.294362215324,259.127336994853,257.958937395230,257.285514880828,256.120091728047,255.450543680866,254.787928283145,254.138565438832,253.502563068272,252.878226782737,252.263680325785,251.656084061751,251.610487148698,251.587023907677,251.585873906986,251.607046037941,251.652997400468,251.724088237068,251.813665622545,251.921266826446,252.595091003271,253.301382247147,254.036218774451,254.804325634986,255.602544610062,256.435439695447,257.300212686539,258.202540676145,259.140341407091,260.102893125343,261.086258873529,262.527710682534
};

int main(int argc, char** argv)
{
	//initialize ros 
	ros::init(argc, argv, "gnc_node");
	ros::NodeHandle gnc_node("~");
	
	//initialize control publisher/subscribers
	init_publisher_subscriber(gnc_node);

  	// wait for FCU connection
	wait4connect();

	//wait for used to switch to mode GUIDED
	set_mode("GUIDED");

	//create local reference frame 
	initialize_local_frame();

	//request takeoff
	takeoff(3);

	std::vector<gnc_api_waypoint> waypointList;
	gnc_api_waypoint nextWayPoint;


	for (int i = 0; i < 499; i++) {
		nextWayPoint.x = ((xList[i] - xList[0]) / 20);
		nextWayPoint.y = ((yList[i] - yList[0]) / 20);
		nextWayPoint.z = 3;
		nextWayPoint.psi = 0;
		waypointList.push_back(nextWayPoint);


	}

	ros::Rate rate(2.0);
	int counter = 0;
	while(ros::ok())
	{
		ros::spinOnce();
		rate.sleep();
		if(check_waypoint_reached(1) == 1)
		{
			if (counter < waypointList.size())
			{
				set_destination(waypointList[counter].x,waypointList[counter].y,waypointList[counter].z, waypointList[counter].psi);
				counter++;	
			}else{
				//land after all waypoints are reached
				land();
			}	
		}	
		
	}
	
	return 0;

}