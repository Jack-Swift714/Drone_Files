#include <gnc_functions.hpp>
#include <math.h>
//include API 


double xList [500] = {
118.361622340181,119.751646465388,121.299389516424,122.998332382957,124.744198878153,126.543751808283,128.398664197694,130.305090009096,132.255426214831,134.237752917367,136.236577641589,138.172121673483,140.145609477389,142.141513752181,144.141121944363,146.128388930673,148.081970944123,149.974939042451,151.959990625000,153.906591251315,155.784358684878,157.558186377053,159.476445492386,161.309461718264,163.263055019187,165.150597339409,166.936843499161,168.861061241104,170.700286964002,172.656091304440,174.545614746556,176.527304182087,178.462880025097,180.318016051356,182.052558977804,183.939760779407,185.720146401211,187.637826427338,189.462503601855,191.149738453575,193.000060278172,194.725217623418,196.603748094957,198.367433981319,200.271349286629,202.071155933698,203.718188885584,205.534123623725,207.204136617899,209.038070918133,210.734726688830,212.241480966838,213.941462228646,215.453902769128,217.159906072782,218.681801453629,220.396831451828,221.931743342010,223.658433481416,225.209422472057,226.948473028735,228.515356507028,230.266969118098,231.852200498027,233.620932298502,235.228877838959,237.014870275753,238.645817107070,240.449772154384,242.105279707901,243.928451098642,245.609242140033,247.451294037396,249.158003784337,250.678823557092,252.387724654958,254.249933595619,255.984307479155,257.864874149075,259.625470791603,261.523405591168,263.309053252518,265.223954881914,267.034218767274,268.964874758217,270.799188608229,272.486943666980,274.327095519755,276.021916831827,277.515284315052,279.192115266191,281.023331626310,282.704523196799,284.538599638961,286.223266382461,287.701358246396,289.363428418349,291.182166097303,292.844647322570,294.663713813053,296.327024125091,298.146008784872,299.807900736899,301.625872947066,303.286927645306,305.105040516218,306.767949556359,308.587706522053,310.499751140213,312.464211467937,314.459657098145,316.455275825927,318.411065726166,320.278181321109,322.237757457851,324.110954564568,325.841308724586,327.396722363578,329.141255165919,330.716627343809,332.476819932811,334.071712275506,335.448343553921,336.589616131119,337.993182487400,339.168261045154,340.602205907029,341.812022496393,343.276807623376,344.523325187276,346.019335938533,347.302821944123,348.831162581191,350.152392252603,351.713199715215,353.072465997347,354.185415599546,355.558386075906,356.690482133384,358.084567156095,359.714118094740,361.166253912518,362.845301149750,364.359715996946,366.089290928916,367.687985308150,369.496272033512,371.195504672212,372.755041564733,374.534291878709,376.197246192415,378.055142905871,379.823169674583,381.750117311380,383.614194151756,385.592229089673,387.534881841794,389.534745545254,391.525795382481,393.506338389402,395.502064203910,397.501890842689,399.450977466618,401.426345614743,403.266728971341,405.150071521059,407.071664906344,408.795944940411,410.570756144654,412.393627859920,413.947785529127,415.556218094314,417.218448206557,418.933010182262,420.324723695192,421.770791335251,423.271421100878,424.375412655491,425.528476403645,426.760989069595,428.074961505694,429.471201563406,430.949526803662,432.045893779491,433.220993466796,434.476762644196,435.814133076821,437.233244557988,438.252926443099,439.349235817744,440.524277081334,441.779663499058,443.116076570043,444.032363654246,445.021850317531,446.086853030533,447.229376053262,448.451025869877,449.752908358831,450.626334243433,451.571035582003,452.589358986602,453.683411536492,454.854974991903,456.105419765410,457.435605301147,458.343258672593,459.322870686756,460.376584981915,461.506291180819,462.713560434139,463.999552098610,465.364911087211,466.316278655520,467.339330362005,468.436342430193,469.609391565782,470.860243801726,472.190261306168,473.600276131512,475.090115415066,476.658767161628,477.871861832588,479.162271301356,480.531293105385,481.979678907963,483.507465724135,485.113776202858,486.796582260363,488.552402544702,490.376013574846,492.260108527413,493.936818365615,495.686949986836,497.505825935549,499.386551239863,501.319564426318,503.292130352538,505.287830844454,507.286112244934,509.257034157635,511.252150291451,513.250655075983,515.226624059606,517.148875678855,519.141849240873,521.100080918482,522.989165708896,524.769250810761,526.685170303512,528.504800832198,530.183940047957,532.026459039195,533.736801750696,535.266637673352,536.988626470965,538.533149704406,540.266577853397,541.825436650413,543.157970223173,544.706570652128,546.025699590712,547.561839143533,548.864681170372,550.385493073687,551.668379490126,553.170439518046,554.429216377080,555.908647179777,557.138628316348,558.591023842064,559.787017009257,561.207485761333,562.363837045333,563.747038848459,564.857767563201,566.198050680915,567.257060740397,568.548205105856,569.548567878113,570.783821234390,572.241038183258,573.443140622688,574.869530001792,576.033655356946,577.424509477897,578.545242607623,579.895504396430,580.967589538534,582.272327194402,583.793583430126,585.076057036729,586.577029781766,587.834235475995,589.312467682919,590.541692283542,591.994561853315,593.193447608956,594.618888113392,596.249419422162,597.672654808261,599.301796218650,600.723738248567,602.352353595828,603.774773262361,605.404770193636,607.208450660820,608.864032615525,610.688180367733,612.372837985688,614.219861401140,615.937816046575,617.810322503061,619.781473944720,621.693096078130,623.682007699670,625.629830190054,627.628862842707,629.606685780822,631.603754161728,633.600464336224,635.577469325886,637.575213664636,639.506424032308,641.478682759189,643.329260438011,645.239040309240,646.964070700920,648.762562931351,650.627379669028,652.274238123405,653.999286699634,655.797377336298,657.337854234982,658.960087852257,660.661148962741,662.058680864460,663.539353410955,665.102542564806,666.311300317766,667.601217978235,668.973650387007,670.429020858302,671.492409472701,672.633417976242,673.854277574363,675.156608029355,676.541291374606,677.518384015621,678.570510930786,679.700060420702,680.904976246868,682.186830826915,683.032545736286,683.943948691853,684.923598794344,685.973931546839,687.097182478019,688.295298012813,689.569853825781,690.405765204807,691.306621196051,692.274927619089,693.313092486514,694.423389360500,695.607874175780,696.868043255271,698.204956345808,699.116841537840,700.095814329733,701.144307572113,702.264625398388,703.462941746383,704.740809819381,706.095524082651,707.527674027157,708.559875970994,709.662422557906,710.837632735215,712.087635928371,713.413999210554,714.817829263438,716.299639771162,717.859185740334,719.495248384421,720.798723492889,722.178811756192,723.636935381699,725.173581345112,726.788315654212,728.479517415704,730.244033829087,732.076771380895,733.970215859425,735.913772887660,737.701471819355,739.555506293477,741.467838343911,743.426867552621,745.416736296041,747.416651259368,749.400507362725,751.394953107084,753.393460410224,755.367582107273,757.282495484004,759.271601280019,761.217306934145,763.079808498178,764.813231372979,766.691547928419,768.447279897412,770.029393556024,771.788101992908,773.373470464846,775.134003104172,776.720566453457,778.077585677668,779.638489465307,780.962663822227,782.493761368370,783.780033452914,785.276410079066,786.519024800353,787.975211413662,789.167620230837,790.576952473601,791.711761683073,793.066769281131,794.135615447631,795.428190252478,796.422694255444,797.644711954636,799.083799395646,800.257127583982,801.650384236944,802.766963030143,804.106596691747,805.158314516675,806.436274869541,807.414738395582,808.622994637338,810.050702243611,811.211711989297,812.595126555205,813.701801936742,815.034175296838,816.079912591733,817.354818756562,818.845783095725,820.086972470684,821.546678744498,822.749142519306,824.173382548443,825.332936557263,826.717944765206,828.310082223033,829.680774389208,831.260197388685,832.615060051460,834.180712708693,835.519158928016,837.071182839539,838.809470624098,840.373814097932,842.122641791839,843.701750717549,845.463570027745,847.061417236890,848.839598330557,850.753179956287,852.568585032926,854.506716366350,856.361185436648,858.322766216747,860.217269104198,862.199325836469,864.132929806791,866.129250415234,868.107372723155,870.105432458626,872.038911857075,874.012653561848,876.009139345197,877.933072223681,879.899885913287,881.736519947780,883.633720065726,885.334850202375,887.110000092610,888.953083840736,890.562797036911,892.250846645243,894.013318514466,895.498270040806,897.064195751905,898.709521452368,900.027145160447,901.429739602089
};
double yList [500] = {
182.407776997282,180.969780845917,179.703095625362,178.647826400824,177.672147057520,176.799444787751,176.051581145361,175.446981587289,175.004049668593,174.738755785488,174.670201268211,174.166545333469,173.841975020853,173.714044860726,173.753631193677,173.978953019347,174.407342231072,175.052843415204,175.296913517059,175.755984319474,176.444453247930,177.368322999829,177.934257595381,178.734289792024,179.162627526283,179.823826429316,180.723451160396,181.268782327296,182.054434120541,182.472560156470,183.128076107227,183.398089034885,183.901622704024,184.648931424752,185.644602472995,186.306772662620,187.217940615125,187.785834370500,188.604707504018,189.678596956030,190.437747234577,191.449593138924,192.135977337095,193.079063809402,193.691523204144,194.563702103891,195.698286810030,196.536368564283,197.636848731888,198.434774155986,199.493716645341,200.808894027181,201.862489637225,203.171123891517,204.214940315952,205.512566783683,206.541484713005,207.823688085866,208.832916089084,210.095624745469,211.083401623776,212.326332098683,213.291657567496,214.511100666656,215.444689343745,216.634021567694,217.534149900609,218.691738961293,219.555304932873,220.677487957272,221.499708171072,222.583655344684,223.362657788468,224.405318730336,225.704205645658,226.743271109291,227.472776326078,228.468741803446,229.149527379078,230.098368494502,230.729116856846,231.629928951300,232.207121943059,233.057383470686,233.579463392379,234.376515899844,235.449587594401,236.233067752878,237.294943790910,238.625302223832,239.715365506996,240.519508928553,241.602834781339,242.400433429975,243.478347138649,244.825657214975,245.938097210438,246.770078733761,247.881904338626,248.713166693844,249.823751587433,250.655192990949,251.767899214437,252.601552045694,253.715507740259,254.548853760004,255.660039398957,256.489789111707,257.076377023420,257.451737677721,257.586632958890,257.454323120535,257.036129545590,256.319275756368,255.919199058337,255.218390525719,254.215457586332,252.958203271709,251.980141258565,250.747987655669,249.798397191510,248.591617006384,247.140794369639,245.498388541430,244.073607335940,242.455216041133,241.061012995268,239.468422708942,238.106657482565,236.542626164819,235.215240828105,233.681401307995,232.391372278443,230.889922260833,229.639370356809,228.172266006650,226.510537032669,225.056249553853,223.407505026449,221.973445421881,220.813892172409,219.438646170152,218.351999780960,217.045650795967,216.041374661281,214.839635803705,213.985177426205,212.930374866682,211.678238819415,210.764855920399,209.653738037126,208.913319370338,207.978396194286,207.442791111185,206.718072177271,206.422474842405,205.946974805944,205.923625981902,205.734627183814,206.012924502770,206.143609135787,206.117276364788,206.565674995941,206.878597796921,207.661534001702,208.334602230354,208.889109995522,209.902450197091,210.824429149831,211.647313533984,212.906120087527,214.094793584854,215.206994580157,216.236692220955,217.673053421325,219.054678689035,220.376839914648,222.044533725676,223.678683043424,225.253774319596,226.761579491749,228.193540979095,229.540594980989,231.213311171595,232.831687124485,234.388300041396,235.875391271260,237.284689892568,239.005227265942,240.677981209314,242.296399581942,243.853321205594,245.341272852557,247.119029298002,248.857107588294,250.549965887532,252.191502101733,253.775033511451,255.293289743104,257.092491572835,258.855312999102,260.576654755885,262.250885629474,263.871823342635,265.432716634442,266.926238124249,268.708418069514,270.452080967469,272.151988666193,273.802371623011,275.396893792813,276.928633143652,278.390069023959,280.149301740221,281.867837514030,283.540130706699,285.159993579135,286.720560362017,288.214231489768,289.632631360154,290.966939761229,292.207637830061,293.797732581732,295.325752019734,296.783757266671,298.162952164751,299.453637038890,300.645176650461,301.725992903497,302.683643742323,303.504888413985,304.175847585405,305.266097152466,306.234105059666,307.065784254546,307.746131467161,308.259415034978,308.589541778391,308.720612547684,308.637718371196,308.977522453036,309.117206427029,309.039884850483,308.730778759046,308.178557143846,308.011056752519,307.604450435782,306.947671435944,306.035916518153,305.462111239947,304.632084289136,303.545580035071,302.767683019440,301.730992222135,300.442736793367,299.425507919959,298.154898624637,297.157288053178,295.904307905305,294.412880978678,293.147244098905,291.643948105632,290.363215786113,288.845782870594,287.546886741284,286.012545696237,284.692009565522,283.137827845400,281.791988144681,280.214919216676,278.839947494465,277.236950194396,275.829019612167,274.197194956148,272.752635240585,271.089420966281,269.604954340057,267.908340744121,266.380942227838,264.649100917590,263.076158087794,261.706297232111,260.107876222140,258.705944219802,257.079656373974,255.642462993029,253.985973556922,252.510577643383,250.822195741063,249.306392439391,248.008016736727,246.473330629287,245.151558781102,243.596105843081,242.248949748780,240.671291078084,239.296820266015,237.695985188650,236.293088411152,235.134914136217,233.729780322037,232.569651766679,231.163209139497,230.002342200237,228.596382637425,227.437456408526,226.573317083937,225.451243828193,224.631192013907,223.553264043091,222.786123571748,221.762096308329,221.059444495253,220.720974416742,220.133011136378,219.922700504924,219.468841996185,219.406645102159,219.109632601639,219.217881767861,219.103214950252,219.405624061978,219.500584880157,220.020610375492,220.352567472479,221.111093842915,221.705013739407,222.717076063466,223.591962168669,224.314775100817,225.449613076586,226.461644404979,227.337355580163,228.612867604653,229.782635996680,230.834487268675,232.265188000373,233.609661432633,234.857234945209,236.450629025360,237.979063658967,239.433858930939,240.805681365252,242.499554044873,244.142143340724,245.726284067326,247.244156059952,248.687295704403,250.432371625638,252.133262261271,253.783752476277,255.380053779871,256.915256970205,258.727649392410,260.507914724484,262.251556223385,263.953555374100,265.608338545880,267.209750162325,268.751018302406,270.567953129640,272.353578645541,274.103545122678,275.812993486345,277.476496071741,279.088015765189,280.641068852206,282.128571251651,283.908589621374,285.652611488419,287.355744460528,289.012514803131,290.613776159103,292.152299213208,293.623607904440,295.019654657399,296.732710157708,298.401359618706,300.019655339256,301.580902282279,303.077819261834,304.502340649043,305.845559774578,307.097684516781,308.248031866334,309.764920999265,311.212455587968,312.581351308153,313.861475982990,315.041574754710,316.109206059011,317.050737697833,317.851408083319,318.495510564858,318.967300855133,319.864035224729,320.614072669641,321.199722845841,321.602469117603,321.803522304496,321.785079434326,321.531475488827,321.680425724841,321.603169273347,321.282477013946,320.705322996704,320.496856854949,320.034007519308,319.305249724169,318.307629988441,317.620660616808,316.662847872554,315.439362534990,314.487026126975,313.267761263139,312.318801397881,311.101091769642,309.631908722802,308.381477051046,306.882623398258,305.595867670003,304.064363793246,302.737390925134,301.170257027076,299.799300956584,298.193635607664,296.774557516259,295.127679239610,293.656640691779,291.966206465801,290.440018281508,288.704805963639,287.121558433131,285.732664147331,284.113003391970,282.678138973644,281.018846413973,279.533793669895,277.832650049641,276.294203646121,274.549896010351,272.956121605281,271.555532089758,269.927018543477,268.482662583600,266.816748540229,265.325178485117,263.620351951400,262.079373602791,260.746322463733,259.178059432386,257.810851476665,256.212702275159,254.808586774424,253.179036376114,251.736208505601,250.525796048881,249.069361022665,247.842404222805,246.371232184933,245.126751668050,243.640628618643,242.379192223869,241.390073637422,240.143947842861,239.173586210775,237.946225220380,236.999656301483,235.796791264903,234.881328541399,234.299774277663,233.460545817879,232.966939766049,232.217977505781,231.827848241118,231.186865550680,230.919562146181,230.408508640218,230.287248472382,230.582260565198,230.670336064008,231.181860663388,231.504883391444,231.623392955974,232.169728273418,232.532555932753,233.324247427809,233.957202175373,235.008941809590,235.930268498230,236.706826478932,237.893765157239,238.966373436068,239.911726761653,241.251472619800,242.495609536429,243.632668611146,245.137284098208,246.563022093870
};

int main(int argc, char** argv)
{
	//initialize ros 
	ros::init(argc, argv, "gnc_node");
	ros::NodeHandle gnc_node("~");
	
	//initialize control publisher/subscribers
	init_publisher_subscriber(gnc_node);

  	// wait for FCU connection
	wait4connect();

	//wait for used to switch to mode GUIDED
	set_mode("GUIDED");

	//create local reference frame 
	initialize_local_frame();

	//request takeoff
	takeoff(3);

	std::vector<gnc_api_waypoint> waypointList;
	gnc_api_waypoint nextWayPoint;


	for (int i = 0; i < 500; i++) {
		nextWayPoint.x = ((xList[i] - xList[0]) / 20);
		nextWayPoint.y = ((yList[i] - yList[0]) / 20);
		nextWayPoint.z = 3;
		nextWayPoint.psi = 0;
		waypointList.push_back(nextWayPoint);


	}

	ros::Rate rate(2.0);
	int counter = 0;
	while(ros::ok())
	{
		ros::spinOnce();
		rate.sleep();
		if(check_waypoint_reached(1) == 1)
		{
			if (counter < waypointList.size())
			{
				set_destination(waypointList[counter].x,waypointList[counter].y,waypointList[counter].z, waypointList[counter].psi);
				counter++;	
			}else{
				//land after all waypoints are reached
				land();
			}	
		}	
		
	}
	
	return 0;

}