#include <gnc_functions.hpp>
#include <math.h>
//include API 


double xList [499] = {
146.921026593342,148.907747580076,150.885378823864,152.710219625121,154.546556561816,156.394391776657,157.961790832021,159.535482989691,161.115501272084,162.701114954938,164.292160182684,165.889852975702,167.088846703826,168.285127225794,169.477200088627,170.665623740597,171.851478469984,173.035617885240,173.725831072265,174.908974590973,175.598639970608,176.781809113497,177.470409144156,178.178192044790,178.905478473526,179.652453982762,180.419188173581,181.205745881123,182.012112278802,182.838260722502,183.684208429907,184.550944621696,185.439415332710,186.350543361761,187.285237384587,188.244378681055,189.228888118451,190.239683157441,191.278123287274,192.345633293131,193.443698684465,194.573855831457,195.737719590980,196.936924191914,198.173104987023,199.447874597075,200.248255169923,201.064420624996,201.896802795592,202.745867533425,203.612055680984,204.495769364077,205.397381273657,206.317235961374,207.255664069689,208.213023460947,209.189655372822,210.185902507741,211.202118231127,212.238686909045,213.296092223879,214.374797665191,215.475250496425,216.597932619819,217.743293143142,218.911768278163,220.103754329894,221.319592720245,222.559618616339,223.824137973693,225.113502057004,226.428017211873,227.767977555518,229.133673941080,230.525401044520,231.943443848933,233.388112313640,234.860231974312,236.360337955389,237.889088706380,239.447344559347,241.036198170354,242.657092993186,244.311880090024,246.003609614451,247.734948985057,249.508910259584,251.328457979929,253.195994460547,255.111523865526,257.072511608591,259.064954434390,261.063150518606,263.026831428341,264.900458180001,266.615588671347,268.096547917704,269.726694043127,271.091109437367,272.611752574043,273.832985270402,275.216591060484,276.757493276357,278.005369060287,279.415579146740,280.497563983422,281.745874523382,283.159301217672,284.247071527773,285.503373025610,286.925881152579,288.025648193973,289.294577952339,290.729367027984,291.844131230450,293.127382814812,294.055420436542,295.153610034345,296.424373335681,297.341146924140,298.432486728201,299.700886450737,300.619351039985,301.717502890477,302.997558825839,303.935289584854,305.058416609879,306.368266219438,307.347827852613,308.518685449081,309.880296438408,310.928805575788,312.173504812447,313.610703443115,314.757836457135,316.103298753379,317.638509598244,318.912821808611,320.382220666428,321.576321583236,322.973765894483,324.563966580508,325.919113821890,327.473559628784,329.206079574543,330.753232219971,332.480342146088,334.022648408862,335.748476884892,337.622390997949,339.374277798316,341.267676385471,343.050108502820,344.966173381306,346.956495711631,348.906989373953,350.906271554007,352.884771997300,354.881816213022,356.878253711453,358.856569989602,360.854944718475,362.790788308170,364.766896355806,366.627780387616,368.547532053012,370.291793891222,372.110712542991,373.996261303798,375.679785034225,377.443266665914,379.279988172589,380.881927250679,382.567524184175,383.945709001661,385.412249171443,386.967600687257,388.609801099747,389.926826913936,391.333321610724,392.829751923222,393.953126137359,395.164166090536,396.465831827423,397.859548481718,398.853185057782,399.933698136843,401.104856965351,402.369397127315,403.728632765047,404.680253533288,405.720495248135,406.853245243420,408.081399559786,409.406436923170,410.317348721146,411.318820735151,412.414925783424,413.609040829278,414.903073294890,415.778921208049,416.748524905249,417.816953129113,418.988631722619,420.266230505320,421.128225842261,422.092406881679,423.166565503633,424.357715466870,425.669757042816,426.587992299483,427.633625060376,428.823001640827,430.166524895189,431.661450199641,432.831911051511,434.165330260408,435.664979929643,436.861836728304,438.254922965116,439.843381095912,441.187718259402,442.749664260780,444.502290122389,446.069339062210,447.811891497950,449.358879405010,451.096055903664,452.664099169911,454.440983930301,456.368604936939,458.217169954333,460.180949936669,462.077395879044,464.060849409349,465.989420027352,467.983757590290,469.939995499893,471.939918633448,473.923910110520,475.915869046229,477.915789394659,479.868105054089,481.850025276030,483.714649980185,485.628569402845,487.583359843465,489.380902044337,491.232312511398,492.841584152295,494.515324235615,496.256951620141,497.703108373356,499.380447221049,500.879734512963,502.665114463674,504.174171466773,505.878459084872,507.257560791455,508.674767369644,510.425838380126,511.860172233909,513.341076468588,514.410190950225,515.480610615619,516.975206747144,518.464212949969,519.518689861324,521.004318730942,522.491207733720,523.543331593647,525.033458685830,526.088364686896,527.578696031517,528.633963107453,530.121965631396,531.175230413754,532.227658285171,533.716594876756,534.766147095783,536.251418656283,537.295708242444,538.774206136221,539.810492742943,541.281097415072,542.307578611027,543.770050310417,544.786210341917,546.243094939153,547.253080486332,548.707850853564,549.719450163874,551.177368935330,552.632565894908,553.652546791407,555.116487192855,556.574010562499,558.028529139735,559.480136694861,561.258123578691,562.705029723092,564.151635910132,565.924077163634,567.361725731167,568.797931923663,570.567063094803,572.005108532405,573.776921761809,575.547651521569,577.318020406663,579.277642176654,581.045506749885,583.004126627171,584.771747565077,586.731396701039,588.504668507118,590.467884895831,592.459132091040,594.423763708850,596.413885224248,598.381407073531,600.369450643797,602.356882362670,604.200975511132,606.187776345062,608.028801147869,610.014320667072,611.849387887656,613.832180116770,615.655747974440,617.172434211862,618.992692680697,620.505766005466,622.323887742786,623.822818237201,625.630727273913,627.120456804780,628.919829494891,630.392690590689,631.858880219230,633.638548062775,635.078280481201,636.510450737311,637.487987575367,638.912444652569,640.311297352934,641.680980172138,643.025566337930,644.344096839048,645.636090093937,647.280688188198,648.508855168222,649.726138212368,650.915384474183,652.081519841472,653.629870803749,654.727894378436,655.794580601921,657.267781485415,658.270346896483,659.700772702373,660.649940286645,662.041658148989,662.945659604986,664.303241703640,665.632114153789,666.478633036071,667.790338747510,669.079059861549,670.720584539304,671.944325061739,673.536174953690,674.692446152996,676.237250586379,677.336600690504,678.842614300324,679.898237179866,681.373732919401,682.829472662689,684.594135465712,685.993020599388,687.369062673390,689.074743307062,690.391474334198,692.057953928048,693.325116193252,694.957511175055,696.829764216742,698.399238299233,700.227360603989,702.022107221103,703.973652277296,705.675882632481,707.571639355877,709.562702012994,711.382376870712,713.339514624920,715.339419959291,717.224989800859,719.208456319095,721.199583418091,723.142646903233,725.142358720747,727.098589045264,729.072981514029,730.934655439863,732.933701979225,734.865323997629,736.625521635911,738.595049693490,740.435624587070,742.042873122231,743.946935830055,745.647391741945,747.047477910314,748.823239892288,750.337278879323,751.906011984714,753.169374187855,754.886756018635,756.145366677071,757.698634017046,758.972449642945,760.514806846589,761.753298298264,763.460969015541,764.923518919904,766.036222261750,767.646989169262,768.942526519445,770.327825634459,771.346191948052,772.898784219615,774.137939615228,775.506676259693,776.542677802319,777.906720946852,778.690981863567,779.846501580756,781.330982406858,782.309677699275,783.660772592497,784.934607540218,786.119108220736,787.629863309869,788.605399856293,789.954347148122,791.227344787491,792.812092690177,793.883623614890,795.274609747324,796.127081926358,797.369657014950,798.942595726552,800.049418175192,801.516692453163,802.918795784757,804.617317112251,805.878888103148,807.467039669313,808.574353513866,810.041824429789,811.785408644185,813.130224023368,814.772931806787,815.971834107965,817.503805589511,819.297744491936,821.060093030875,822.998332636371,824.687233052439,826.584303870359,828.191784805728,830.040478379789,832.019402245276,833.817878929329,835.776614401060,837.723044205091,839.722563568934,841.661962554536,843.661855887322,845.661793834223,847.661063554500,849.605760096097,851.605013103678,853.549932644050,855.485981613902,857.410722880875,859.323039219355,861.242716857131,862.936442715954,864.852024030308,866.517996897473,868.411087810459,870.023080472454,871.874504421785,873.474710768528,875.096072181354,876.730928032971
};
double yList [499] = {
196.168433603950,195.938347270431,196.236633481295,197.055141911348,197.847522283979,198.612705280909,199.854985523545,201.089284106907,202.315474233805,203.534420191897,204.746267988968,205.949338119566,207.550092329281,209.152875194412,210.758789977238,212.367407154642,213.977919048665,215.589692557952,217.466819553244,219.079324255296,220.956652586764,222.569138487266,224.446857848027,226.317430852635,228.180507461521,230.035777681354,231.882969788481,233.721808273151,235.552046845768,237.373441572062,239.185725345740,240.988159359468,242.779979605941,244.560385659255,246.328533583976,248.083540129094,249.824442529483,251.550215802295,253.259496966045,254.950775295415,256.622377041153,258.272451228304,259.898926297055,261.499522537554,263.071736594800,264.612827909839,266.445692045177,268.271581951482,270.090136300979,271.900961822935,273.703659272045,275.497830425061,277.283074376039,279.058987480188,280.825156409119,282.581135621972,284.326469432080,286.060681543146,287.783268436031,289.493685161850,291.191299370132,292.875459270760,294.545490278326,296.200659408599,297.840217053701,299.463382436168,301.069361655361,302.657359454021,304.226542610002,305.776055693160,307.304957344891,308.812289394448,310.297047380605,311.758167971954,313.194516004135,314.604889927906,315.987978148910,317.341811116696,318.664566591277,319.954109588368,321.207839502143,322.422559306374,323.594182101183,324.717427249910,325.784222083128,326.785453317055,327.709066545889,328.539275009704,329.255031597909,329.830137760857,330.223237075977,330.396936776390,330.312010873251,329.932593840498,329.232934783912,328.204184378005,326.860026756805,325.701310393854,324.238993522598,322.939899818941,321.356046700328,319.911873920619,318.636875739789,317.073927875054,315.655722138192,313.973667200567,312.411066549145,310.996066556259,309.317747232512,307.761563905736,306.355693844633,304.685211143536,303.139307760936,301.745973519482,300.085461317509,298.551425668890,296.779774977402,295.108254828771,293.563858301975,291.786352693685,290.110352266456,288.564013964573,286.787381532611,285.115836584588,283.579133359387,281.812594080572,280.157726809260,278.646338705450,276.902647503772,275.281199851581,273.816271350341,272.113148163714,270.547669383832,269.156820687529,267.518502693931,266.038728653956,264.756883241354,263.215413685862,261.858628147671,260.254220780298,258.823434494033,257.610478691803,256.139568784917,254.881118057462,253.881931069182,252.614524783990,251.606015337774,250.332715926085,249.322015143793,248.623126099034,247.658298322329,247.014060951356,246.106902890683,245.533583275258,245.337071134644,244.894833106833,244.841253590971,244.548788215434,244.657482283593,244.538162063778,244.831870598913,244.912483519720,245.414986849300,245.723202656923,246.456080968890,247.016931700556,247.995476865464,248.827062662749,249.493925370224,250.573623406292,251.517091760129,252.308580298846,253.505990500109,254.582449035207,256.031795994653,257.391670963322,258.649002129823,259.790570264110,261.295709129716,262.717599655709,264.044511981312,265.699211463095,267.290871675518,268.809313742050,270.243731354720,271.979440533906,273.662441272461,275.283671360514,276.833167465311,278.300300206790,280.059395972646,281.767581318178,283.415876634006,284.994368628029,286.492459408200,288.272976101834,290.004176207300,291.677064046681,293.281460898232,294.806413349275,296.604437384992,298.353685414968,300.044383829959,301.665238318652,303.203985000352,305.008691081433,306.760933907992,308.447997408540,310.054596849932,311.564082491795,313.340833462925,315.045724113186,316.653636843988,318.135171610704,319.463779278192,321.085513348328,322.576148519437,323.899421306720,325.501773890735,326.936803763875,328.152040681808,329.632836951002,330.881966523456,331.845451131128,333.088172990680,334.069758956703,335.337366315237,336.328435340343,337.569902341587,338.487878674775,339.021055244750,339.784473463334,340.163377383843,340.798588205263,341.055321711297,341.585053125669,341.735444897569,342.151537724991,342.169072258709,342.421614965797,342.242451357741,342.260300725619,341.826176819408,341.557863133840,340.834554961167,340.254113367581,339.831272578087,338.954436198775,338.197944769573,337.010407491924,335.915604252303,334.932377903251,333.550845911174,332.461564317637,331.137880965658,330.236538393937,328.924003837668,327.877388476232,326.428913939728,325.017699740984,324.051392172841,322.657589318815,321.313371089617,319.623106546666,317.933668255418,316.604690300886,315.269452296653,313.570017554329,312.231022833743,310.893427568568,309.192535043047,307.858548068170,306.159379645407,304.825620865402,303.126676664304,301.790320241511,300.090133987525,298.389429552455,297.054113924509,295.351633340321,294.012242287802,292.306528577874,290.959664079085,289.249076440661,287.893597964878,286.177108420968,284.812858983188,283.090239236877,281.720024921401,279.993777779624,278.621318972001,276.896017017160,275.526903122761,274.154896632676,272.434536504454,271.071863212352,269.702328390983,268.329602741599,266.953799156090,266.037959300587,264.657212180620,263.276150799067,262.349623949545,260.959240334758,259.567366858957,258.634535202495,257.244562066282,256.316834800265,255.387041211398,254.456560684631,254.056707563376,253.121477724933,252.716745497035,251.781055259896,251.381336278707,250.456400009678,250.074586689996,250.261494709011,249.887031618300,250.085567141442,249.726599493047,249.944963324123,250.168827485658,250.942985389315,251.172381218167,251.953807910474,252.194041627637,252.989358102971,253.251149959540,254.072490490910,255.376201677184,256.204850641845,257.512753204680,258.346079880291,259.670167253887,260.525424475414,261.859855412129,262.732929247542,264.085955556408,265.446208464201,266.358777566598,267.747003255502,269.143029171277,270.887856306051,272.291751613831,273.721160975309,275.178545267381,276.659115442267,278.162936348366,279.689616874646,280.827728076750,282.406210217661,283.993100885110,285.601110004723,287.225957168353,288.491899227698,290.163528441798,291.855326450021,293.207982783637,294.938549915109,296.336363212314,298.096783871409,299.533140857549,301.317175993850,302.785838938645,304.280528876804,306.092545924721,307.602323433686,309.131767087512,310.274306685217,311.856222970534,313.067013588888,314.698894991949,315.969162390019,317.639919508382,318.955944966736,320.654668115512,322.004820818955,323.376251385849,324.317508625730,325.746886246508,327.198267729983,328.242611340064,329.748008099120,330.853831667001,332.401184178113,333.556730206354,334.260056978128,335.499714634252,336.310867418168,337.193411796857,337.630986811739,338.680944819417,339.318209635409,339.507073330791,340.337003094199,340.748842639472,340.729383616934,341.396186715734,341.652819860586,341.464636769843,341.938455609388,341.972406263186,341.556277776488,341.237256806511,340.506387328514,340.444638373324,339.926144035828,338.976562931242,338.628770995729,337.846285174053,336.656011194575,336.044010210364,334.991180835908,333.562979617192,332.642833224831,331.336048642071,330.095453444575,328.544996755830,327.520009123071,325.965692806979,324.705787822241,323.163907881644,321.890670175491,320.320275663234,319.279189345317,317.915023747874,316.253129866470,315.067621549477,313.543947380147,312.101398815300,310.380082443641,309.119345659740,307.549474994519,306.091202044040,304.380441744150,302.917777633750,301.077958399555,299.445544792902,298.105277402813,296.361099795858,294.886466760318,293.344602782541,291.733094750339,290.422515084444,288.676568794723,287.199970947011,285.657415596249,284.437344252052,282.748610561566,281.311544947414,279.502321029826,277.935155706954,276.699897106683,275.034080770112,273.674997920098,272.248776952809,271.192829368860,269.640914862539,268.425277333139,266.759787600460,265.400917072807,264.421165018813,262.940803037433,261.799965126818,260.199142440751,258.913427316888,258.029242260257,257.083659039542,256.590478310310,255.519210190460,254.885868014542,253.695907913352,252.932801060268,252.643214571271,251.768296508298,251.364124080016,250.904329541142,250.948173738219,250.459572085906,250.480227774661,250.464473138917,250.410430696479,250.877501741503,250.822844521699,251.288986111220,251.790697568470,252.334178069694,252.919879547908,253.480983608684,254.544606058220,255.119539296169,256.226126123250,256.871267034346,258.055108095331,258.811566527661,260.011291349378,261.182268364096,262.334330143879
};

int main(int argc, char** argv)
{
	//initialize ros 
	ros::init(argc, argv, "gnc_node");
	ros::NodeHandle gnc_node("~");
	
	//initialize control publisher/subscribers
	init_publisher_subscriber(gnc_node);

  	// wait for FCU connection
	wait4connect();

	//wait for used to switch to mode GUIDED
	set_mode("GUIDED");

	//create local reference frame 
	initialize_local_frame();

	//request takeoff
	takeoff(3);

	std::vector<gnc_api_waypoint> waypointList;
	gnc_api_waypoint nextWayPoint;


	for (int i = 0; i < 499; i++) {
		nextWayPoint.x = ((xList[i] - xList[0]) / 20);
		nextWayPoint.y = ((yList[i] - yList[0]) / 20);
		nextWayPoint.z = 3;
		nextWayPoint.psi = 0;
		waypointList.push_back(nextWayPoint);


	}

	ros::Rate rate(2.0);
	int counter = 0;
	while(ros::ok())
	{
		ros::spinOnce();
		rate.sleep();
		if(check_waypoint_reached(1) == 1)
		{
			if (counter < waypointList.size())
			{
				set_destination(waypointList[counter].x,waypointList[counter].y,waypointList[counter].z, waypointList[counter].psi);
				counter++;	
			}else{
				//land after all waypoints are reached
				land();
			}	
		}	
		
	}
	
	return 0;

}